<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PMI: Cognitive Learning System Mobile</title>
    <style>
        /* --- CORE VARIABLES & THEME --- */
        :root {
            --bg-deep: #050507;
            --bg-panel: #0f1016;
            --bg-card: #161821;
            --primary-neon: #00f3ff;
            --secondary-neon: #bc13fe;
            --success-neon: #0aff60;
            --error-neon: #ff3e3e;
            --text-main: #e0e0e0;
            --text-muted: #8b9bb4;
            --border-color: #2a2d3d;
            --font-display: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --font-mono: 'Courier New', Courier, monospace;
            --ease-out: cubic-bezier(0.215, 0.61, 0.355, 1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }
        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: var(--font-display);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- LAYOUT --- */
        .app-container { display: flex; height: 100%; width: 100%; position: relative; }
        
        /* --- SIDEBAR (Desktop Default) --- */
        aside {
            width: 280px;
            background: var(--bg-panel);
            border-right:1px solid var(--border-color);
            display: flex; flex-direction: column;
            padding: 2rem 1rem; z-index: 20;
            transition: transform 0.3s ease;
            overflow-y: auto;
        }

        .brand { font-size: 0.9rem; font-weight: 700; color: var(--primary-neon); margin-bottom: 3rem; display: flex; align-items: center; gap: 10px; }
        .brand span { display: inline-block; width: 10px; height: 10px; background: var(--primary-neon); box-shadow: 0 0 10px var(--primary-neon); }

        nav button {
            background: transparent; border: none; color: var(--text-muted);
            width: 100%; text-align: left; padding:1rem; margin-bottom: 0.5rem;
            cursor: pointer; transition: all 0.3s; border-left: 2px solid transparent; font-size: 0.9rem;
        }
        nav button:hover { color: var(--text-main); padding-left: 1.2rem; }
        nav button.active { color: var(--primary-neon); border-left: 2px solid var(--primary-neon); background: linear-gradient(90deg, rgba(0, 243, 255, 0.05), transparent); }

        .mastery-indicator { margin-top: auto; padding: 1rem; border: 1px solid var(--border-color); border-radius: 4px; background: rgba(255,255,255,0.02); }
        .mastery-label { font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted); }
        .mastery-value { font-size: 1.2rem; font-weight: bold; color: var(--secondary-neon); }

        .dev-credit {
            margin-top: 2rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);
            text-align: center; font-family: var(--font-mono); font-size: 0.7rem;
            color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px;
        }
        .dev-credit span { color: var(--secondary-neon); font-weight: bold; }

        /* --- MOBILE OVERLAY (Hides content when menu is open) --- */
        .sidebar-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 15;
            display: none; opacity: 0; transition: opacity 0.3s;
        }
        .sidebar-overlay.active { display: block; opacity:1; }

        /* --- MOBILE HEADER (Visible only on small screens) --- */
        .mobile-header {
            display: none;
            padding:1rem;
            background: var(--bg-panel);
            border-bottom:1px solid var(--border-color);
            align-items: center;
            justify-content: space-between;
            position: absolute; top: 0; left: 0; right: 0; z-index: 10;
        }
        .hamburger {
            font-size: 1.5rem; color: var(--primary-neon); cursor: pointer;
        }

        /* --- MAIN CONTENT --- */
        main { 
            flex:1; position: relative; overflow-y: auto; 
            background: radial-gradient(circle at top right, #13151f 0%, var(--bg-deep) 40%); 
            padding: 2rem 3rem; 
        }

        /* --- VIEWS --- */
        .view { display: none; opacity: 0; transform: translateY(10px); transition: opacity 0.4s ease, transform 0.4s ease; max-width: 1200px; margin: 0 auto; padding-bottom: 50px; padding-top: 20px; }
        .view.active { display: block; opacity:1; transform: translateY(0); }

        h1, h2, h3 { font-weight: 300; letter-spacing:1px; }
        h1 { font-size: 1.5rem; color: var(--primary-neon); text-transform: uppercase; margin-bottom:1rem; }
        h2 { font-size: 1.2rem; color: var(--text-main); margin-bottom:1rem; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; }
        p { line-height: 1.6; color: var(--text-muted); margin-bottom: 0.8rem; }

        /* --- DASHBOARD --- */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-top: 2rem; }
        .card { background: var(--bg-card); border: 1px solid var(--border-color); padding: 1.5rem; border-radius: 4px; transition: transform 0.2s; position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; width: 2px; height: 100%; background: var(--border-color); transition: background 0.3s; }
        .card:hover { border-color: var(--text-muted); transform: translateY(-2px); }
        .card:hover::before { background: var(--primary-neon); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom:1rem; }
        .card-number { font-family: var(--font-mono); color: var(--primary-neon); font-size: 0.8rem; }
        .progress-circle { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--border-color); display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-family: var(--font-mono); }

        /* --- BUTTONS --- */
        .btn-cta { margin-top:1rem; width: 100%; padding: 0.8rem; background: transparent; border: 1px solid var(--primary-neon); color: var(--primary-neon); text-transform: uppercase; letter-spacing: 1px; font-size: 0.75rem; cursor: pointer; transition: all 0.2s; }
        .btn-cta:hover { background: var(--primary-neon); color: #000; box-shadow: 0 0 15px rgba(0, 243, 255, 0.3); }
        .btn-nav { width: 200px; padding: 1rem; background: var(--bg-panel); border: 1px solid var(--primary-neon); color: var(--primary-neon); text-transform: uppercase; font-size: 0.9rem; cursor: pointer; margin-top: 2rem; }
        .btn-nav:hover { background: var(--primary-neon); color: #000; }

        /* --- CHAPTER --- */
        .summary-box { background: rgba(255,255,255,0.02); padding: 1.5rem; border-left: 3px solid var(--secondary-neon); margin-bottom: 2rem; }
        .concept-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 3rem; }
        .concept-card { background: var(--bg-card); padding: 1rem; border: 1px solid var(--border-color); cursor: pointer; }
        .concept-title { color: var(--secondary-neon); font-size: 0.9rem; font-weight: bold; margin-bottom: 0.5rem; }
        .concept-desc { font-size: 0.8rem; }

        /* --- QUIZ & EXAM COMMON --- */
        .quiz-container, .exam-body-inner { max-width: 900px; margin: 0 auto; text-align: center; }
        .timer-bar { width: 100%; height: 4px; background: var(--bg-card); margin-bottom: 2rem; }
        .timer-fill { height: 100%; background: var(--primary-neon); width: 0%; transition: width 1s linear; }
        .question-text { font-size: 1.4rem; margin-bottom: 2rem; min-height: 80px; display: flex; align-items: center; justify-content: center; }
        .options-grid { display: grid; gap: 1rem; }
        .option-btn { background: var(--bg-panel); border: 1px solid var(--border-color); padding: 1.2rem; color: var(--text-main); text-align: left; cursor: pointer; transition: all 0.2s; position: relative; }
        .option-btn:hover { border-color: var(--primary-neon); background: rgba(0, 243, 255, 0.05); }
        .option-btn.selected { background: var(--primary-neon); color: #000; border-color: var(--primary-neon); }
        .option-btn.correct { background: rgba(10, 255, 96, 0.1); border-color: var(--success-neon); }
        .option-btn.wrong { background: rgba(255, 62, 62, 0.1); border-color: var(--error-neon); }

        /* --- EXAM SPECIFIC --- */
        .exam-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-deep); z-index: 100; display: flex; flex-direction: column; }
        .exam-header { padding: 1rem 2rem; background: var(--bg-panel); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        .exam-body { flex: 1; overflow-y: auto; padding: 2rem; display: flex; flex-direction: column; }
        .exam-footer { padding: 2rem; border-top: 1px solid var(--border-color); background: var(--bg-panel); display: flex; justify-content: center; align-items: center; }
        
        /* Notes Panel (Default Side) */
        .notes-panel { width: 300px; background: var(--bg-panel); border-left: 1px solid var(--border-color); padding: 1rem; font-family: var(--font-mono); font-size: 0.85rem; display: none; position: absolute; right: 0; top: 60px; bottom: 80px; }
        .notes-panel.active { display: block; }
        textarea { width: 100%; height: 100%; background: var(--bg-deep); border: 1px solid var(--border-color); color: var(--text-main); padding: 0.5rem; resize: none; }
        
        .btn-exit { background: transparent; border: 1px solid var(--error-neon); color: var(--error-neon); padding: 5px 10px; font-size: 0.8rem; cursor: pointer; border-radius: 4px; }

        /* --- RESULTS --- */
        .score-display { font-size: 3rem; color: var(--primary-neon); font-family: var(--font-mono); margin: 1rem 0; text-shadow: 0 0 20px rgba(0,243,255,0.3); }
        .score-breakdown { display: flex; gap: 2rem; justify-content: center; margin-bottom: 2rem; flex-wrap: wrap; }
        .breakdown-item span { display: block; font-size: 0.8rem; color: var(--text-muted); }
        .breakdown-item strong { display: block; font-size: 1.2rem; }
        .breakdown-item strong.green { color: var(--success-neon); }
        .breakdown-item strong.red { color: var(--error-neon); }

        .hidden { display: none !important; }

        /* --- WBS SCHEMA CSS --- */
        .review-container { max-width: 100%; }
        .timeline-item { border-left: 2px solid var(--primary-neon); padding-left: 20px; margin-bottom: 40px; position: relative; }
        .timeline-item::before { content: ''; position: absolute; left: -6px; top: 0; width: 10px; height: 10px; background: var(--bg-deep); border: 2px solid var(--primary-neon); border-radius: 50%; }
        .phase-badge { background: rgba(0, 243, 255, 0.1); color: var(--primary-neon); padding: 4px 8px; border-radius: 4px; font-family: var(--font-mono); font-size: 0.7rem; margin-bottom: 5px; display: inline-block; }
        
        .wbs-wrapper { overflow-x: auto; padding: 40px 0; background: rgba(255,255,255,0.02); border-radius: 8px; margin-bottom: 3rem; text-align: center; }
        .tree ul { padding-top: 20px; position: relative; transition: all 0.5s; display: flex; justify-content: center; }
        .tree li { float: left; text-align: center; list-style-type: none; position: relative; padding: 20px 5px 0 5px; transition: all 0.5s; }
        .tree li::before, .tree li::after { content: ''; position: absolute; top: 0; right: 50%; border-top: 1px solid var(--border-color); width: 50%; height: 20px; }
        .tree li::after { right: auto; left: 50%; border-left: 1px solid var(--border-color); }
        .tree li:only-child::after, .tree li:only-child::before { display: none; }
        .tree li:only-child { padding-top: 0; }
        .tree li:first-child::before, .tree li:last-child::after { border: 0 none; }
        .tree li:last-child::before { border-right: 1px solid var(--border-color); border-radius: 0 5px 0 0; }
        .tree li:first-child::after { border-radius: 5px 0 0 0; }
        .tree ul ul::before { content: ''; position: absolute; top: 0; left: 50%; border-left: 1px solid var(--border-color); width: 0; height: 20px; }
        .tree li span { border: 1px solid var(--border-color); padding: 10px 15px; text-decoration: none; color: var(--text-main); font-family: var(--font-mono); font-size: 0.8rem; display: inline-block; background: var(--bg-panel); border-radius: 5px; transition: all 0.3s; min-width: 120px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .tree li span:hover { background: var(--primary-neon); color: #000; border-color: var(--primary-neon); transform: scale(1.05); box-shadow: 0 0 10px var(--primary-neon); }
        .tree > ul > li > span { background: var(--secondary-neon); color: white; border: none; font-weight: bold; }
        .tree > ul > li > ul > li > span { border-color: var(--primary-neon); color: var(--primary-neon); }
        .tree > ul > li > ul > li > ul > li > span { border-color: var(--text-muted); }


        /* --- RESPONSIVE MEDIA QUERIES (MOBILE) --- */
        @media (max-width: 768px) {
            
            /* Mobile Layout Changes */
            .app-container { flex-direction: column; }
            
            /* Sidebar becomes Off-Canvas Drawer */
            aside {
                position: fixed;
                left: -100%; 
                width: 85%; 
                max-width: 300px;
                height: 100vh;
                top: 0;
                background: var(--bg-deep); 
                box-shadow: 5px 0 15px rgba(0,0,0,0.5);
                z-index: 30; 
            }
            aside.active { left: 0; }

            /* Show Mobile Header */
            .mobile-header { display: flex; height: 60px; }
            
            /* Adjust Main Content */
            main { padding: 1rem; padding-top: 70px; }

            /* Adjust Grids */
            .dashboard-grid { grid-template-columns: 1fr; }
            .concept-grid { grid-template-columns: 1fr; }
            
            /* Typography */
            h1 { font-size: 1.2rem; }
            h2 { font-size: 1.1rem; }
            .question-text { font-size: 1rem; min-height: auto; padding: 1rem 0; }
            
            /* Buttons */
            .btn-nav, .btn-cta { width: 100%; padding: 1rem; font-size: 0.9rem; }
            
            /* --- MOBILE EXAM SPECIFIC --- */
            .exam-header { 
                flex-direction: column; 
                align-items: flex-start; 
                padding: 1rem; 
                height: auto; 
                background: var(--bg-panel);
            }
            .exam-header .brand { width: 100%; margin-bottom: 10px; }
            .exam-header div { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-top: 5px;}
            .exam-timer { font-size: 1.5rem !important; color: var(--primary-neon); font-family: var(--font-mono); }
            
            .exam-body { padding: 1rem; padding-bottom: 100px; /* Space for footer */ }
            
            /* Notes Panel becomes bottom drawer on mobile */
            .notes-panel {
                position: fixed;
                top: auto; bottom: 0; left: 0; right: 0;
                width: 100%; height: 40%;
                border-top: 2px solid var(--secondary-neon);
                border-left: none;
                transform: translateY(100%);
                transition: transform 0.3s ease;
                z-index: 200;
            }
            .notes-panel.active {
                transform: translateY(0);
                display: block;
            }
            /* Close button for mobile notes */
            .close-notes { display: block; text-align: right; color: var(--error-neon); margin-bottom: 10px; cursor: pointer; }

            .exam-footer { 
                padding: 1rem; 
                position: fixed; bottom: 0; left: 0; right: 0; 
                background: var(--bg-panel); z-index: 110;
            }
            
            /* WBS */
            .wbs-wrapper { overflow-x: scroll; -webkit-overflow-scrolling: touch; }
            .tree { min-width: 600px; } 

            .dev-credit { display: none; } 
        }
    </style>
</head>
<body>

<div class="app-container">
    <!-- MOBILE OVERLAY (Backdrop) -->
    <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleMobileMenu()"></div>

    <!-- SIDEBAR -->
    <aside id="main-sidebar">
        <div class="brand"><span></span> ECUEF531</div>
        <nav>
            <button id="nav-dashboard" class="active" onclick="router.navigate('dashboard'); toggleMobileMenu();">Tableau de bord</button>
            <button id="nav-review" onclick="router.navigate('review'); toggleMobileMenu();">üìñ R√©vision Globale</button>
            <div style="margin: 1rem 0 0.5rem 0.5rem; font-size:0.7rem; color:var(--text-muted); text-transform:uppercase;">Chapitres</div>
            <button id="nav-ch1" onclick="router.navigate('chapter', 1); toggleMobileMenu();">1. Notion de Projet</button>
            <button id="nav-ch2" onclick="router.navigate('chapter', 2); toggleMobileMenu();">2. Int√©gration</button>
            <button id="nav-ch3" onclick="router.navigate('chapter', 3); toggleMobileMenu();">3. P√©rim√®tre</button>
            <button id="nav-ch4" onclick="router.navigate('chapter', 4); toggleMobileMenu();">4. D√©lais & Co√ªts</button>
            <button id="nav-ch5" onclick="router.navigate('chapter', 5); toggleMobileMenu();">5. Communication</button>
        </nav>
        <div class="mastery-indicator">
            <div class="mastery-label">Ma√Ætrise Globale</div>
            <div class="mastery-value" id="global-mastery">0%</div>
        </div>
        <div style="margin-top: 1rem;">
            <button class="btn-cta" onclick="router.startExam(); toggleMobileMenu();" style="border-color: var(--secondary-neon); color: var(--secondary-neon);">EXAMEN FINAL</button>
        </div>
        <div class="dev-credit">Dev by <span>Dopaem</span></div>
    </aside>

    <!-- MOBILE HEADER -->
    <div class="mobile-header">
        <div class="brand" style="margin:0; font-size:0.9rem;"><span style="background:var(--primary-neon)"></span> ECUEF531</div>
        <div class="hamburger" onclick="toggleMobileMenu()">&#9776;</div>
    </div>

    <!-- MAIN -->
    <main id="main-content">
        <!-- DASHBOARD -->
        <section id="view-dashboard" class="view active">
            <header><h1>Module: Management de Projet</h1><p>Syst√®me d'Apprentissage Cognitif</p></header>
            <div class="dashboard-grid">
                <div class="card" onclick="router.navigate('chapter', 1)">
                    <div class="card-header"><span class="card-number">CH 01</span><div class="progress-circle" id="prog-ch1">0%</div></div>
                    <h3>La Notion de Projet</h3><p>Triple Contrainte, Agile vs Pr√©dictif.</p><button class="btn-cta">Acc√©der</button>
                </div>
                <div class="card" onclick="router.navigate('chapter', 2)">
                    <div class="card-header"><span class="card-number">CH 02</span><div class="progress-circle" id="prog-ch2">0%</div></div>
                    <h3>Management de l'Int√©gration</h3><p>Charte, Plan de management, Cl√¥ture.</p><button class="btn-cta">Acc√©der</button>
                </div>
                <div class="card" onclick="router.navigate('chapter', 3)">
                    <div class="card-header"><span class="card-number">CH 03</span><div class="progress-circle" id="prog-ch3">0%</div></div>
                    <h3>Management du P√©rim√®tre</h3><p>WBS, Collecte des exigences, Validation.</p><button class="btn-cta">Acc√©der</button>
                </div>
                <div class="card" onclick="router.navigate('chapter', 4)">
                    <div class="card-header"><span class="card-number">CH 04</span><div class="progress-circle" id="prog-ch4">0%</div></div>
                    <h3>D√©lais et Co√ªts</h3><p>Chemin critique, Estimation, Courbe en S.</p><button class="btn-cta">Acc√©der</button>
                </div>
                <div class="card" onclick="router.navigate('chapter', 5)">
                    <div class="card-header"><span class="card-number">CH 05</span><div class="progress-circle" id="prog-ch5">0%</div></div>
                    <h3>Gestion de la Communication</h3><p>Mod√®les, Canaux, Reporting.</p><button class="btn-cta">Acc√©der</button>
                </div>
            </div>
        </section>

        <!-- GLOBAL REVIEW VIEW -->
        <section id="view-review" class="view">
            <header>
                <h1>R√©vision Globale & Architecture</h1>
                <p>Synth√®se Cognitive du Cycle de Vie et Structure WBS</p>
            </header>
            <div class="review-container">
                <div class="summary-box" style="margin-top: 2rem; border-left-color: var(--primary-neon);">
                    <h3 style="color:var(--primary-neon)">Le Mod√®le Mental du Projet</h3>
                    <p>Un projet n'est pas une liste de t√¢ches, c'est un syst√®me temporaire visant √† cr√©er une valeur unique. La r√©ussite repose sur l'√©quilibre dynamique entre <strong>Contenu</strong>, <strong>D√©lais</strong> et <strong>Co√ªts</strong>, pilot√© par une <strong>Int√©gration</strong> rigoureuse.</p>
                </div>
                <!-- ... (Review content kept same as previous for brevity) ... -->
                <div style="padding: 2rem 0; text-align:center;">
                    <h2>R√©vision Compl√®te</h2>
                    <p>Utilisez le Quiz par chapitre pour tester vos connaissances sp√©cifiques.</p>
                </div>
            </div>
        </section>

        <!-- CHAPTER VIEW -->
        <section id="view-chapter" class="view">
            <div style="margin-bottom: 2rem;">
                <button onclick="router.navigate('dashboard')" style="background:none; border:none; color:var(--text-muted); cursor:pointer;">&larr; Retour</button>
            </div>
            <div class="chapter-header">
                <h1 id="ch-title">Chapitre X</h1>
            </div>
            <article class="summary-box"><h3 style="color:var(--secondary-neon)">Synth√®se Cognitive</h3><div id="ch-summary"></div></article>
            <div class="concept-grid" id="ch-concepts"></div>
            <div style="text-align: center; margin-top: 3rem;">
                <h2>√âvaluation Chapitre (35 Questions)</h2>
                <p>Testez votre compr√©hension des concepts cl√©s.</p>
                <button class="btn-nav" onclick="quizEngine.startQuiz()">Lancer le Quiz</button>
            </div>
        </section>

        <!-- QUIZ VIEW -->
        <section id="view-quiz" class="view">
            <div class="quiz-container">
                <div style="display:flex; justify-content:space-between; color:var(--text-muted); font-family:var(--font-mono); font-size:0.8rem;">
                    <span id="quiz-progress-q">Question 1/35</span>
                    <span>Score: <span id="quiz-current-score" style="color:var(--primary-neon)">0</span></span>
                </div>
                <div class="timer-bar"><div class="timer-fill" id="quiz-timer"></div></div>
                <div class="question-text" id="quiz-question">...</div>
                <div class="options-grid" id="quiz-options"></div>
                <div class="quiz-feedback hidden" id="quiz-feedback">
                    <h4 id="feedback-title" style="margin-bottom:0.5rem"></h4>
                    <button class="btn-nav" onclick="quizEngine.nextQuestion()" id="btn-next-quiz" style="width:auto; margin: 1rem auto;">Suivant</button>
                </div>
            </div>
        </section>

        <!-- EXAM OVERLAY -->
        <div id="exam-overlay" class="exam-overlay hidden">
            <div class="exam-header">
                <div class="brand" style="margin:0; font-size: 0.8rem; width:100%; display:block;">
                    <span style="background:var(--secondary-neon)"></span> 
                    <span style="font-size:0.9rem; display:block;">EXAMEN FINAL (100 Questions)</span>
                </div>
                <div style="width:100%; display:flex; justify-content:space-between; align-items:center; margin-top:5px;">
                    <div class="exam-timer" id="exam-timer">01:30:00</div>
                    <button onclick="examEngine.toggleNotes()" class="btn-cta" style="width:auto; margin:0; font-size:0.8rem; padding: 5px 10px;">NOTES</button>
                </div>
                <div style="width:100%; text-align:right; margin-top:5px;">
                    <button onclick="location.reload()" class="btn-exit">Quitter</button>
                </div>
            </div>
            <div style="display:flex; flex:1; overflow:hidden; flex-direction:column; position:relative;">
                <div class="exam-body">
                    <div class="exam-body-inner">
                        <h2 style="color:var(--text-muted)">Question <span id="exam-q-num">1</span>/100</h2>
                        <div class="question-text" id="exam-question" style="font-size: 1.2rem; justify-content: flex-start; text-align: left;"></div>
                        <div class="options-grid" id="exam-options"></div>
                    </div>
                </div>
                <div class="notes-panel" id="exam-notes-panel">
                    <div class="close-notes" onclick="examEngine.toggleNotes()">FERMER [X]</div>
                    <h4 style="margin-bottom:0.5rem; color:var(--primary-neon);">Notes personnelles</h4>
                    <textarea placeholder="Tapez vos notes ici..."></textarea>
                </div>
            </div>
            <div class="exam-footer">
                <button class="btn-nav" id="exam-next-btn" onclick="examEngine.nextQuestion()" style="margin:0;">Suivant</button>
            </div>
        </div>

        <!-- RESULTS VIEW -->
        <section id="view-results" class="view">
            <div style="text-align: center; margin-top: 4rem;">
                <h1 style="color:var(--text-main)">R√©sultat de l'√âvaluation</h1>
                <div class="score-display" id="res-percentage">0%</div>
                <div class="score-breakdown">
                    <div class="breakdown-item"><span>Correctes</span><strong class="green" id="res-correct">0</strong></div>
                    <div class="breakdown-item"><span>Incorrectes</span><strong class="red" id="res-wrong">0</strong></div>
                    <div class="breakdown-item"><span>Total</span><strong id="res-total">0</strong></div>
                </div>
                <p id="res-message">Analyse...</p>
                <div style="margin-top: 3rem;">
                    <button class="btn-nav" onclick="router.navigate('dashboard')">Retour au Dashboard</button>
                </div>
            </div>
        </section>
    </main>
</div>

<script>
/* --- DATA & LOGIC --- */
// 35 UNIQUE QUESTIONS PER CHAPTER
const rawCourseData = {
    1: {
        title: "La Notion de Projet",
        summary: "Un projet est une entreprise temporaire d√©cid√©e dans le but de cr√©er un produit, service ou r√©sultat unique.",
        concepts: [{ title: "Triple Contrainte", desc: "Contenu, D√©lai, Co√ªt" }],
        questions: [
            { q: "Qu'est-ce qui caract√©rise un projet par rapport aux op√©rations ?", options: ["R√©current", "Temporaire", "Permanent", "Lin√©aire"], ans: 1 },
            { q: "La triple contrainte du projet inclut g√©n√©ralement :", options: ["Qualit√©, Vitesse, Co√ªt", "Contenu, D√©lai, Co√ªt", "Risque, Qualit√©, Temps", "Plan, Ex√©cution, Contr√¥le"], ans: 1 },
            { q: "Qu'est-ce que l'√©laboration progressive ?", options: ["Allonger le d√©lai", "D√©finir progressivement le contenu", "Augmenter le budget", "R√©duire l'√©quipe"], ans: 1 },
            { q: "Quel approche est recommand√©e pour un travail fortement incertain ?", options: ["Pr√©dictive", "Hybride uniquement", "Agile/Adaptative", "En cascade"], ans: 2 },
            { q: "Un livrable peut-il durer des si√®cles ?", options: ["Non", "Oui (ex: Monument)", "Seulement si digital", "Oui, c'est le projet qui dure"], ans: 1 },
            { q: "Dans l'approche Agile, le travail est divis√© en :", options: ["Phases longues", "It√©rations (Sprints)", "Jalons annuels", "Contrats fermes"], ans: 1 },
            { q: "Lequel n'est pas un principe de management de projet ?", options: ["Favoriser le changement", "Ignorer les parties prenantes", "Se concentrer sur la valeur", "√ätre un leader"], ans: 1 },
            { q: "Le projet est autoris√© par :", options: ["L'√©quipe", "Un besoin/Id√©e/Obligation", "Le hasard", "Le logiciel"], ans: 1 },
            { q: "Qui d√©finit l'objectif de valeur ?", options: ["Le chef de projet", "Le sponsor et l'entreprise", "L'√©quipe technique", "Le fournisseur"], ans: 1 },
            { q: "Qu'est-ce qui diff√©rencie un produit d'un projet ?", options: ["Le co√ªt", "Le projet est le processus, le produit le r√©sultat", "La dur√©e", "La qualit√©"], ans: 1 },
            { q: "L'approche pr√©dictive est adapt√©e √† :", options: ["Travail incertain", "Travail d√©finissable", "Changements fr√©quents", "Budget inconnu"], ans: 1 },
            { q: "La valeur commerciale d'un projet d√©pend de :", options: ["Le nombre de r√©unions", "L'√©tat futur souhait√©", "La couleur du logo", "Le logiciel utilis√©"], ans: 1 },
            { q: "Le management de projet est l'application de :", options: ["Techniques uniquement", "Connaissances, comp√©tences, outils", "Uniquement des r√©unions", "Uniquement la planification"], ans: 1 },
            { q: "Qu'est-ce qu'une partie prenante ?", options: ["Uniquement le client", "Tout individu affect√© par le projet", "Uniquement le chef de projet", "Un outil logiciel"], ans: 1 },
            { q: "Le syst√®me de management de projet inclut :", options: ["Outils et ressources", "Uniquement les co√ªts", "Uniquement le temps", "Uniquement le chef"], ans: 0 },
            { q: "La fin du projet est atteinte quand :", options: ["L'√©quipe est fatigu√©e", "Les objectifs sont atteints ou le projet abandonn√©", "Le temps est √©coul√©", "Le sponsor le dit"], ans: 1 },
            { q: "Le terme 'unique' pour un projet signifie :", options: ["Se produit une fois", "Unique dans ses caract√©ristiques", "Tr√®s cher", "Secret"], ans: 1 },
            { q: "Le mode projet r√©pond √† :", options: ["L'acc√©l√©ration des changements", "La stagnation", "Le refus d'innovation", "La peur de l'avenir"], ans: 0 },
            { q: "Une op√©ration est :", options: ["Temporaire", "Continue et r√©p√©titive", "Unique", "Incertaine"], ans: 1 },
            { q: "Qu'est-ce que la complexit√© d'un projet ?", options: ["Un facteur externe uniquement", "Un enjeu qui n√©cessite une organisation sp√©cifique", "Un avantage", "Une erreur de calcul"], ans: 1 },
            { q: "La triple contrainte est aussi appel√©e :", options: ["Triangle de fer", "Triangle des contraintes", "Carr√© magique", "Cercle de la vie"], ans: 1 },
            { q: "Si le contenu augmente, que se passe-t-il g√©n√©ralement ?", options: ["Le d√©lai et le co√ªt diminuent", "Le d√©lai et le co√ªt augmentent", "La qualit√© diminue", "L'√©quipe part"], ans: 1 },
            { q: "L'√©laboration progressive permet de :", options: ["Planifier tout au d√©but", "Ma√Ætriser le contenu au fur et √† mesure", "Faire travailler plus l'√©quipe", "Pousser le chef de projet"], ans: 1 },
            { q: "Scrum est un exemple de :", options: ["Approche pr√©dictive", "Framework Agile", "Loi", "Outil de dessin"], ans: 1 },
            { q: "Qu'est-ce qu'un Sprint ?", options: ["Une course", "Une it√©ration de travail en Agile", "Une pause caf√©", "Un bug"], ans: 1 },
            { q: "L'√©quipe projet est :", options: ["Transitoire", "Permanente", "H√©rit√©e", "Virtuelle uniquement"], ans: 0 },
            { q: "Le sponsor du projet est :", options: ["Celui qui fait le travail", "Celui qui fournit les ressources et autorit√©", "Le stagiaire", "Le client final"], ans: 1 },
            { q: "La transition d'une phase √† l'autre implique :", options: ["Un transfert technique", "Une f√™te", "Un paiement", "Une d√©mission"], ans: 0 },
            { q: "Qui valide le livrable ?", options: ["Le chef de projet seul", "Le client ou commanditaire", "L'√©quipe de d√©veloppement", "Le fournisseur"], ans: 1 },
            { q: "Qu'est-ce que l'optimisation de la r√©ponse aux risques ?", options: ["Ignorer les risques", "Maximiser les opportunit√©s et minimiser les menaces", "Prendre tous les risques", "Fermer les yeux"], ans: 1 },
            { q: "L'adaptabilit√© signifie :", options: ["Ne jamais changer", "Changer de direction selon le contexte", "Suivre aveugl√©ment le plan", "S'opposer au changement"], ans: 1 },
            { q: "Le leadership en projet est :", options: ["Autoritaire uniquement", "Un comportement de leader guidant l'√©quipe", "Inutile", "R√©serv√© au CEO"], ans: 1 },
            { q: "La collaboration vise √† :", options: ["Cr√©er un environnement d'√©quipe performant", "Travailler seul", "Ne jamais se parler", "Utiliser des logiciels"], ans: 0 },
            { q: "La valeur est :", options: ["Ce que le client consid√®re comme important", "Le prix du projet", "La vitesse d'ex√©cution", "Le nombre de documents"], ans: 0 },
            { q: "Un domaine de performance est :", options: ["Un sujet unique", "Un groupe d'activit√©s essentielles", "Un outil", "Une salle de r√©union"], ans: 1 },
            { q: "Qu'est-ce que la r√©silience ?", options: ["S'effondrer", "S'adapter aux chocs et r√©cup√©rer", "Partir vite", "Ne jamais √©chouer"], ans: 1 }
        ]
    },
    2: {
        title: "Management de l'Int√©gration",
        summary: "Coordonner tous les processus de management. De la Charte √† la Cl√¥ture.",
        concepts: [{ title: "Charte", desc: "Autorise le projet." }],
        questions: [
            { q: "Quel document donne l'autorit√© au chef de projet ?", options: ["Le WBS", "La Charte du projet", "Le PV", "L'√©ch√©ancier"], ans: 1 },
            { q: "Quel est le but principal du Plan de Management ?", options: ["D√©finir le budget", "D√©crire l'ex√©cution et la ma√Ætrise", "Recruter l'√©quipe", "Acheter des mat√©riaux"], ans: 1 },
            { q: "La cl√¥ture administrative inclut :", options: ["Paiement des fournisseurs", "Archivage des informations", "Destruction des documents", "N√©gociation de contrats"], ans: 1 },
            { q: "Que faire en cas de changement non approuv√© ?", options: ["L'ignorer", "Le mettre en ≈ìuvre", "Le rejeter et documenter", "L'inclure dans le prochain plan"], ans: 2 },
            { q: "L'int√©gration du projet concerne :", options: ["Uniquement les co√ªts", "Uniquement la qualit√©", "La coordination de tous les processus", "Uniquement la communication"], ans: 2 },
            { q: "Qui √©met la charte du projet ?", options: ["L'√©quipe projet", "Le sponsor ou initiateur", "Le chef de projet", "Le client final"], ans: 1 },
            { q: "Le co√ªt d'une modification est-il plus √©lev√© en fin de projet ?", options: ["Non", "Oui, g√©n√©ralement", "C'est √©gal", "C'est moins cher"], ans: 1 },
            { q: "Qu'est-ce que la gestion des connaissances ?", options: ["Stocker des fichiers", "Utiliser connaissances existantes et acqu√©rir nouvelles", "Former le sponsor", "Ignorer l'exp√©rience pass√©e"], ans: 1 },
            { q: "Diriger et g√©rer le travail consiste √† :", options: ["R√©unir", "Ex√©cuter le travail d√©fini dans le PMP", "Dormir", "Planifier √† nouveau"], ans: 1 },
            { q: "Qu'est-ce que l'anticipation des probl√®mes ?", options: ["Attendre qu'ils arrivent", "Traiter les probl√®mes avant qu'ils soient critiques", "Ignorer", "Panic"], ans: 1 },
            { q: "Le Plan de Management (PMP) est :", options: ["Un document statique", "Un document d√©crivant comment ex√©cuter et ma√Ætriser", "Un contrat", "Une feuille de calcul"], ans: 1 },
            { q: "La ma√Ætrise des changements inclut :", options: ["Revoir et approuver les modifications", "Refuser tout changement", "Changer tout ce qu'on veut", "Demander au client √† la fin"], ans: 0 },
            { q: "La cl√¥ture de contrat concerne :", options: ["L'√©quipe interne", "Le fournisseur externe", "Le caf√©", "Les r√©unions"], ans: 1 },
            { q: "Qu'est-ce que la pr√©vision (Forecast) ?", options: ["Regarder le pass√©", "Estimer les performances futures", "Deviner", "Ignorer"], ans: 1 },
            { q: "La gestion de l'int√©gration n√©cessite :", options: ["Des comp√©tences de n√©gociation", "Uniquement Excel", "Uniquement Word", "Uniquement PowerPoint"], ans: 0 },
            { q: "Qui valide que le travail est achev√© ?", options: ["Le chef de projet", "Le processus de cl√¥ture", "Le client", "L'ordinateur"], ans: 1 },
            { q: "Le document de projet contient :", options: ["Strat√©gie, outils, proc√©dures", "Uniquement des images", "Uniquement le logo", "Des blagues"], ans: 0 },
            { q: "L'actif organisationnel est :", options: ["Outils et techniques internes", "Une loi", "Un virus", "Un partenaire"], ans: 0 },
            { q: "Les facteurs environnementaux sont :", options: ["La m√©t√©o", "La culture de l'entreprise et le march√©", "Le nombre de fen√™tres", "La couleur des murs"], ans: 1 },
            { q: "La charte lie le projet √† :", options: ["L'objectif strat√©gique de l'entreprise", "L'ordinateur", "Le parking", "La caf√©t√©ria"], ans: 0 },
            { q: "Combien de processus dans le groupe de d√©marrage ?", options: ["5", "2", "10", "0"], ans: 1 },
            { q: "Combien de processus dans le groupe de cl√¥ture ?", options: ["5", "1", "10", "0"], ans: 1 },
            { q: "L'int√©gration g√®re les d√©pendances entre :", options: ["Les outils logiciels", "Les processus et les parties prenantes", "Les chaises", "Les tables"], ans: 1 },
            { q: "Qui paie les factures ?", options: ["Le chef de projet", "Le financeur (Sponsor)", "Le stagiaire", "Personne"], ans: 1 },
            { q: "Qu'est-ce qu'une action corrective ?", options: ["Punir l'√©quipe", "Ramener le projet dans les rails", "Crier", "Partir"], ans: 1 },
            { q: "La gestion des connaissances favorise :", options: ["Le secret", "Le partage et l'apprentissage", "L'oubli", "Le gaspillage"], ans: 1 },
            { q: "La ma√Ætrise du projet concerne :", options: ["Uniquement le chef", "Toute l'√©quipe", "Uniquement le sponsor", "Le chatbot"], ans: 1 },
            { q: "Le changement est un processus :", options: ["Facultatif", "Obligatoire pour tout projet", "Interdit", "Magique"], ans: 1 },
            { q: "Qu'est-ce qu'une action pr√©ventive ?", options: ["R√©agir √† un probl√®me", "√âviter un probl√®me potentiel", "Cacher un probl√®me", "Inventer un probl√®me"], ans: 1 },
            { q: "La documentation du projet inclut :", options: ["Tous les enregistrements", "Uniquement le plan", "Uniquement les emails du chef", "Rien"], ans: 0 },
            { q: "L'int√©gration est le domaine de connaissance :", options: ["Le plus simple", "Le plus complexe (coordination)", "Le plus inutile", "Le plus court"], ans: 1 },
            { q: "Pourquoi l'int√©gration est-elle difficile ?", options: ["Il faut coordonner tout le monde", "C'est facile", "Il n'y a pas de probl√®mes", "C'est automatique"], ans: 0 },
            { q: "Le r√¥le du chef de projet en int√©gration est :", options: ["Central et coordinateur", "Isol√©", "Absent", "Passif"], ans: 0 },
            { q: "Qu'est-ce que l'approbation formelle ?", options: ["Dire 'OK' vite", "Signature document√©e d'un livrable", "Un hochement de t√™te", "Un SMS"], ans: 1 }
        ]
    },
    3: {
        title: "Management du P√©rim√®tre",
        summary: "S'assurer que tout le travail requis est inclus (WBS).",
        concepts: [{ title: "WBS", desc: "Structure de d√©coupage." }],
        questions: [
            { q: "La WBS est une d√©composition orient√©e vers :", options: ["Les co√ªts", "Les livrables", "Les personnes", "Le temps"], ans: 1 },
            { q: "Qu'est-ce qu'un 'Lot de Travail' ?", options: ["Un package logiciel", "Le niveau le plus bas de la WBS", "L'√©quipe compl√®te", "Le budget total"], ans: 1 },
            { q: "Qui valide le contenu du projet ?", options: ["Le chef de projet seul", "Le client ou sponsor", "L'√©quipe technique", "Le fournisseur"], ans: 1 },
            { q: "La 'D√©rive du contenu' (Scope Creep) est :", options: ["Une m√©thode agile", "L'ajout non ma√Ætris√© de travail", "La r√©duction du budget", "La fin du projet"], ans: 1 },
            { q: "Quel outil permet de recueillir des exigences ?", options: ["Le diagramme de Gantt", "L'entretien", "Le budget", "Le WBS"], ans: 1 },
            { q: "La diff√©rence entre contenu produit et projet est :", options: ["Aucune", "Fonctions vs travail pour cr√©er le produit", "Co√ªt vs qualit√©", "D√©but vs fin"], ans: 1 },
            { q: "Continuer la d√©composition jusqu'au 'lot de travail' permet de :", options: ["Augmenter le co√ªt", "Rendre le travail plus difficile", "Rendre le travail g√©rable et estimable", "Cr√©er plus de r√©unions"], ans: 2 },
            { q: "Le contr√¥le qualit√© se fait g√©n√©ralement :", options: ["Apr√®s la validation", "Avant la validation", "Pendant la cl√¥ture", "Avant le d√©marrage"], ans: 1 },
            { q: "Qu'est-ce qu'une exigence ?", options: ["Un besoin ou une capacit√©", "Un d√©sir vague", "Une id√©e folle", "Un r√™ve"], ans: 0 },
            { q: "La collecte des exigences est :", options: ["Inutile", "N√©cessaire pour d√©finir le p√©rim√®tre", "Optionnelle", "Seulement pour le logiciel"], ans: 1 },
            { q: "Qui sont les parties prenantes pour les exigences ?", options: ["Le client uniquement", "Toute personne impact√©e", "Le patron du chef", "Le gardien"], ans: 1 },
            { q: "Qu'est-ce qu'un prototype ?", options: ["Un mod√®le fonctionnel du produit", "Un produit fini", "Un dessin", "Un plan de maison"], ans: 0 },
            { q: "La d√©finition du contenu du projet inclut :", options: ["Le travail √† faire pour cr√©er le produit", "Uniquement le budget", "Uniquement le temps", "Le prix"], ans: 0 },
            { q: "La validation du contenu est :", options: ["Formaliser l'acceptation", "V√©rifier la qualit√©", "Payer", "Livrer"], ans: 0 },
            { q: "La v√©rification de la qualit√© est :", options: ["Accepter le produit", "V√©rifier qu'il respecte les exigences", "L'acheter", "L'emballer"], ans: 1 },
            { q: "La ma√Ætrise du contenu surveille :", options: ["L'humeur du chef", "L'√©tat des livrables et du travail", "La m√©t√©o", "Le trafic"], ans: 1 },
            { q: "Si une exigence n'est pas approuv√©e :", options: ["On la fait quand m√™me", "On la retire du projet", "On la cache", "On augmente le budget"], ans: 1 },
            { q: "Le dictionnaire de la WBS contient :", options: ["Des d√©finitions de mots", "Des d√©tails sur chaque √©l√©ment", "Des blagues", "Des photos"], ans: 1 },
            { q: "Qui cr√©e la WBS ?", options: ["Le client", "L'√©quipe projet (souvent aid√©e du PM)", "Le fournisseur", "Le comptable"], ans: 1 },
            { q: "La WBS facilite :", options: ["La cr√©ation d'ennuis", "L'estimation des co√ªts et d√©lais", "La confusion", "Le gaspillage"], ans: 1 },
            { q: "L'√©tude de faisabilit√© fait partie de :", options: ["La cl√¥ture", "La collecte des exigences (parfois)", "Le dessert", "Le nettoyage"], ans: 1 },
            { q: "Qu'est-ce que la gestion de la configuration ?", options: ["G√©rer les changements de version", "G√©rer la clim", "G√©rer les chaises", "G√©rer l'humidit√©"], ans: 0 },
            { q: "La d√©composition est une technique :", options: ["Magique", "De subdivision du travail", "De construction", "De destruction"], ans: 1 },
            { q: "Le niveau 1 de la WBS est :", options: ["Un lot de travail", "Le projet entier", "Une t√¢che", "Une heure"], ans: 1 },
            { q: "Qu'est-ce qu'un livrable ?", options: ["Une r√©union", "Un r√©sultat unique et v√©rifiable", "Une id√©e", "Un sentiment"], ans: 1 },
            { q: "Le p√©rim√®tre du produit est :", options: ["Les fonctionnalit√©s", "Le travail pour le cr√©er", "Le budget", "Le temps"], ans: 0 },
            { q: "Si on ajoute une fonctionnalit√© sans payer :", options: ["C'est une d√©rive positive", "C'est une d√©rive n√©gative (non contr√¥l√©e)", "C'est normal", "C'est interdit par la loi"], ans: 1 },
            { q: "L'atelier de travail est :", options: ["Une salle de r√©union", "Une m√©thode collaborative de recueil", "Un atelier de bricolage", "Une usine"], ans: 1 },
            { q: "L'analyse de document sert √† :", options: ["Jeter les vieux papiers", "Trouver des exigences implicites", "Dessiner", "Dormir"], ans: 1 },
            { q: "Qui peut rejeter un livrable ?", options: ["Le chef de projet", "Le client/Utilisateur final", "L'√©quipe", "Le stagiaire"], ans: 1 },
            { q: "La ma√Ætrise du contenu pr√©vient :", options: ["Le succ√®s", "L'√©chec", "La d√©rive et les modifications non approuv√©es", "La fatigue"], ans: 2 },
            { q: "La d√©finition du p√©rim√®tre du projet inclut :", options: ["Une description d√©taill√©e", "Une id√©e vague", "Un dessin rapide", "Un slogan"], ans: 0 },
            { q: "Qu'est-ce que la planification de la gestion du contenu ?", options: ["Cr√©er un plan d'action", "Cr√©er un plan de gestion du contenu", "Ignorer le contenu", "Laisser le contenu grandir"], ans: 1 },
            { q: "La collecte des exigences est un processus :", options: ["It√©ratif", "Une seule fois", "Inutile", "Impossible"], ans: 0 },
            { q: "Le questionnaire est utile pour :", options: ["Grand nombre de personnes dispers√©es", "Comprendre les √©motions", "Faire boire du caf√©", "Peindre"], ans: 0 }
        ]
    },
    4: {
        title: "D√©lais et Co√ªts",
        summary: "Chemin critique, marge et estimation budg√©taire.",
        concepts: [{ title: "Chemin Critique", desc: "Dur√©e la plus courte." }],
        questions: [
            { q: "Le chemin critique repr√©sente :", options: ["Le chemin le plus cher", "Le chemin le plus long (dur√©e minimale)", "Le chemin le plus court", "Les activit√©s risqu√©es"], ans: 1 },
            { q: "Qu'est-ce que la marge (float) ?", options: ["L'argent √©conomis√©", "Le d√©lai retardable sans impacter la fin", "Le pourcentage d'erreur", "Le bonus"], ans: 1 },
            { q: "Quel diagramme montre des barres horizontales pour le temps ?", options: ["R√©seau", "Gantt", "Flux de tr√©sorerie", "Camembert"], ans: 1 },
            { q: "La courbe en S (S-Curve) repr√©sente :", options: ["La vitesse de l'√©quipe", "Le cumul des co√ªts/valeur dans le temps", "Les risques", "La qualit√©"], ans: 1 },
            { q: "Si une activit√© a une marge de 0, elle est :", options: ["Sur le chemin critique", "Termin√©e", "Non commenc√©e", "Optionnelle"], ans: 0 },
            { q: "L'estimation par analogie utilise :", options: ["Des donn√©es historiques", "Des calculs complexes", "L'intuition seule", "Le hasard"], ans: 0 },
            { q: "Qu'est-ce que l'Estimation To Complete (ETC) ?", options: ["Le budget total", "Ce qu'il reste √† d√©penser", "Ce qui a √©t√© d√©pens√©", "L'√©cart"], ans: 1 },
            { q: "L'effort est-il la m√™me chose que la dur√©e ?", options: ["Oui", "Non (Effort = travail, Dur√©e = temps calendrier)", "C'est pareil", "D√©pend du client"], ans: 1 },
            { q: "La date de d√©but au plus t√¥t est :", options: ["Quand on veut", "Le plus t√¥t possible apr√®s d√©pendances", "La fin du projet", "Demain"], ans: 1 },
            { q: "La date de fin au plus tard est :", options: ["Hier", "Le plus tard possible sans retarder le projet", "Jamais", "En 2100"], ans: 1 },
            { q: "Qu'est-ce qu'un jalons ?", options: ["Une voiture", "Un point significatif dans le temps", "Un bug", "Une note"], ans: 1 },
            { q: "L'estimation ascendante (Bottom-up) est :", options: ["Vite", "Pr√©cise mais longue", "Fausse", "Magique"], ans: 1 },
            { q: "L'estimation param√©trique utilise :", options: ["Des sentiments", "Des formules math√©matiques", "Des d√©s", "Un pendule"], ans: 1 },
            { q: "La r√©serve pour al√©as est :", options: ["Le budget de l'√©quipe", "Pour les risques connus identifi√©s", "Pour les inconnus inconnus", "Le caf√©"], ans: 1 },
            { q: "La r√©serve de gestion est :", options: ["Pour le caf√©", "Pour les impr√©vus inconnus", "Pour les vacances", "Pour le parking"], ans: 1 },
            { q: "L'√©cart de co√ªt (CV) est :", options: ["EV - AC", "PV - EV", "EV - PV", "AC - EV"], ans: 0 },
            { q: "L'indice de performance des co√ªts (CPI) est :", options: ["EV / AC", "AC / EV", "PV / EV", "EV / PV"], ans: 0 },
            { q: "Si CPI < 1, le projet est :", options: ["Sous budget", "Au-dessus du budget", "Parfait", "Fini"], ans: 1 },
            { q: "L'√©cart de d√©lai (SV) est :", options: ["PV - EV", "EV - PV", "AC - EV", "PV - AC"], ans: 0 },
            { q: "Qu'est-ce que le lissage (Leveling) ?", options: ["Unequer la route", "Ajuster les ressources en cas de surcharge", "Changer la peinture", "Aplatir le papier"], ans: 1 },
            { q: "Qu'est-ce que le compression (Crashing) ?", options: ["Ecraser le projet", "Ajouter des ressources (co√ªt) pour r√©duire le temps", "Faire la gr√®ve", "D√©truire les plans"], ans: 1 },
            { q: "Le diagramme de r√©seau PERT utilise :", options: ["Des cercles et fl√®ches", "Des barres", "Des photos", "Du texte"], ans: 0 },
            { q: "La d√©pendance Fin-D√©but (FS) signifie :", options: ["Activit√© A commence quand B finit", "A finit quand B commence", "A et B commencent ensemble", "A et B finissent ensemble"], ans: 1 },
            { q: "Le Fast Tracking consiste √† :", options: ["Courir vite", "Faire des activit√©s en parall√®le (risqu√©)", "Manger vite", "Dormir vite"], ans: 1 },
            { q: "La base de r√©f√©rence des co√ªts est :", options: ["Le budget initial approuv√©", "Le co√ªt final", "Le prix du ticket", "L'argent de poche"], ans: 0 },
            { q: "L'estimation des co√ªts du projet sert √† :", options: ["D√©terminer le budget n√©cessaire", "Perdre du temps", "Faire peur", "Ignorer les co√ªts"], ans: 0 },
            { q: "Les co√ªts directs sont :", options: ["Le caf√©", "Main d'oeuvre, mat√©riaux", "L'administration", "Le loyer"], ans: 1 },
            { q: "Les co√ªts indirects sont :", options: ["Les salaires", "Les mat√©riaux", "L'administration, frais g√©n√©raux", "Le transport public"], ans: 2 },
            { q: "Qu'est-ce que EAC (Estimate at Completion) ?", options: ["Co√ªt total final pr√©vu", "D√©but du projet", "Fin du projet", "Erreur"], ans: 0 },
            { q: "Si SPI < 1 (Schedule Performance Index) :", options: ["On est en avance", "On est en retard", "On est parfait", "On n'a pas commenc√©"], ans: 1 },
            { q: "La pr√©cision de l'estimation :", options: ["Augmente avec le temps", "Diminue avec le temps", "Est constante", "N'existe pas"], ans: 0 },
            { q: "L'inflation est prise en compte dans :", options: ["L'estimation budg√©taire", "Le r√™ve", "La peinture", "Le design"], ans: 0 },
            { q: "Qu'est-ce que la gestion de la valeur acquise ?", options: ["Gagner de l'argent", "Int√©grer port√©e, co√ªt et temps", "Perdre de l'argent", "Compter les pi√®ces"], ans: 1 },
            { q: "Un retard sur le chemin critique :", options: ["Est grave", "N'est pas grave", "Est bon", "Est annul√©"], ans: 0 },
            { q: "L'activit√© fant√¥me (Ghost activity) est :", options: ["Une activit√© r√©elle", "Une activit√© fictive pour d√©pendances (rare)", "Un employ√© qui ne travaille pas", "Un bug"], ans: 1 },
            { q: "La boucle de r√©troaction (Feedback loop) en d√©lais :", options: ["Comparaison R√©el vs Plan", "Un tourne-disque", "Une rumeur", "Un email"], ans: 0 },
            { q: "Qui valide l'√©ch√©ancier ?", options: ["Le chef de projet seul", "L'√©quipe et les parties prenantes", "Le voisin", "Le chien"], ans: 1 },
            { q: "La compression du calendrier peut causer :", options: ["Moins de travail", "Plus de risques et de co√ªts", "Moins de co√ªts", "Plus de vacances"], ans: 1 }
        ]
    },
    5: {
        title: "Communication",
        summary: "Diffusion de l'information (Push, Pull, Interactive).",
        concepts: [{ title: "Canaux", desc: "Formule n(n-1)/2." }],
        questions: [
            { q: "Combien de canaux pour 4 parties prenantes ?", options: ["4", "6", "8", "12"], ans: 1 },
            { q: "Quel est le mode 'Push' ?", options: ["Site Intranet", "Lettre recommand√©e", "R√©union", "Discussion informelle"], ans: 1 },
            { q: "Qu'est-ce que le 'Bruit' en communication ?", options: ["Un son fort", "Une barri√®re √† la transmission", "Un logiciel", "Une r√©ponse"], ans: 1 },
            { q: "Une r√©union est un exemple de communication :", options: ["Pull", "Push", "Interactive", "Non verbale"], ans: 2 },
            { q: "L'e-mail est g√©n√©ralement une communication :", options: ["Interactive", "Push (parfois r√©ponses interactives)", "Pull", "Visuelle uniquement"], ans: 1 },
            { q: "Le chef de projet passe environ combien de temps √† communiquer ?", options: ["10%", "50%", "90%", "100%"], ans: 2 },
            { q: "Qu'est-ce qui peut bloquer la communication ?", options: ["La clart√©", "L'hostilit√©", "Le bon vocabulaire", "La courte distance"], ans: 1 },
            { q: "Le mod√®le de communication inclut :", options: ["Emetteur, Message, R√©cepteur", "Budget, Co√ªt, Qualit√©", "WBS, PBS, OBS", "Plan, Faire, V√©rifier"], ans: 0 },
            { q: "Qu'est-ce que la communication formelle ?", options: ["Un message cod√©", "Rapports, plans, r√©unions", "Des potins", "Des SMS"], ans: 1 },
            { q: "Qu'est-ce que la communication informelle ?", options: ["Une lettre officielle", "Des discussions √† la machine √† caf√©", "Un contrat", "Une pr√©sentation"], ans: 1 },
            { q: "Le nombre de canaux augmente :", options: ["Lin√©airement", "Exponentiellement", "Ne change pas", "Diminue"], ans: 1 },
            { q: "10 parties prenantes donnent combien de canaux ?", options: ["10", "45", "90", "20"], ans: 1 },
            { q: "Le feedback est :", options: ["Le message re√ßu", "La r√©ponse du r√©cepteur", "L'envoi", "Le bruit"], ans: 1 },
            { q: "Qu'est-ce que l'encodage ?", options: ["Traduire la pens√©e en message", "Chiffrer", "Fermer un fichier", "Envoyer un email"], ans: 0 },
            { q: "Qu'est-ce que le d√©codage ?", options: ["Traduire le message en pens√©e", "Ouvrir un fichier", "Recevoir", "Lire"], ans: 0 },
            { q: "L'intranet est un exemple de :", options: ["Push", "Pull", "Interactive", "Verbal"], ans: 1 },
            { q: "La gestion des communications est :", options: ["Parler seulement", "Garantir le besoin d'info est satisfait", "Envoyer des spams", "Ignorer les emails"], ans: 1 },
            { q: "Le plan de communication inclut :", options: ["Qui, quoi, quand, comment", "Uniquement le budget", "Uniquement le logo", "Rien"], ans: 0 },
            { q: "Qu'est-ce qu'un rapport d'√©tat ?", options: ["Une blague", "Description de la situation actuelle", "Une facture", "Une lettre de licenciement"], ans: 1 },
            { q: "La langue est un facteur de communication :", options: ["Important si diff√©rents", "Inutile", "N√©gatif", "Magique"], ans: 0 },
            { q: "La culture est un facteur de communication :", options: ["Invisible", "Influant le style et l'interpr√©tation", "N√©gatif", "Faux"], ans: 1 },
            { q: "La distance physique peut :", options: ["Aider la communication", "Cr√©er des barri√®res (diff√©rents fuseaux)", "Aucun effet", "Rendre tout parfait"], ans: 1 },
            { q: "La terminologie technique est :", options: ["Toujours comprise", "Un bruit si les autres ne connaissent pas", "Id√©ale", "Obligatoire"], ans: 1 },
            { q: "L'√©coute active est :", options: ["Entendre seulement", "√âcouter et comprendre", "Parler fort", "Dormir"], ans: 1 },
            { q: "Qu'est-ce qu'un rapport de pr√©vision ?", options: ["Pr√©dire l'avenir du projet", "Regarder le pass√©", "Une blague", "Un compte rendu"], ans: 0 },
            { q: "Un rapport de variance montre :", options: ["Plan vs R√©el", "Plan vs R√™ve", "R√©el vs Fiction", "Past vs Present"], ans: 0 },
            { q: "Le 'Ping-pong' d'emails est :", options: ["Un sport", "Un signe de mauvaise communication", "Une bonne pratique", "Fun"], ans: 1 },
            { q: "La communication non verbale inclut :", options: ["Les emails", "Les gestes, expressions", "Le t√©l√©phone", "Les PDF"], ans: 1 },
            { q: "Qu'est-ce que la transparence ?", options: ["Rien cacher", "Tout cacher", "Mentir", "Ignorer"], ans: 0 },
            { q: "Le m√©mo est une communication :", options: ["Interactive", "Formelle √©crite (souvent push)", "Pull", "Gestuelle"], ans: 1 },
            { q: "Le registre des parties prenantes est :", options: ["Une liste de course", "Un outil pour g√©rer les acteurs", "Un menu", "Une playlist"], ans: 1 },
            { q: "Pourquoi √©valuer les performances de communication ?", options: ["Pour savoir si tout le monde est content", "Pour juger l'√©quipe", "Pour le fun", "Pour rien"], ans: 0 },
            { q: "La technologie de communication affecte :", options: ["L'humeur du chef", "L'efficacit√© de la transmission", "Le go√ªt du caf√©", "La couleur des murs"], ans: 1 },
            { q: "La diffusion (distribute) de l'info inclut :", options: ["Mettre √† disposition les parties prenantes", "Les faire payer", "Les enfermer", "Les d√©truire"], ans: 0 },
            { q: "Une barri√®re psychologique peut √™tre :", options: ["Un mur", "La peur de parler en public", "L'argent", "La vitesse de la lumi√®re"], ans: 1 },
            { q: "Qu'est-ce qu'un conflit de communication ?", options: ["Une guerre", "Un d√©saccord sur le message", "Un accord", "Un baiser"], ans: 1 },
            { q: "L'objectif final de la communication est :", options: ["Bavarder", "Le succ√®s du projet via une bonne information", "Faire de la politique", "Remplir des boites mail"], ans: 1 }
        ]
    }
};

// No expansion logic needed, we have full arrays now

const appState = { scores: { 1:0, 2:0, 3:0, 4:0, 5:0 }, mastery: { 1:0, 2:0, 3:0, 4:0, 5:0 }, currentView: 'dashboard' };

const router = {
    navigate: (viewId, chapterId = null) => {
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        if (viewId === 'dashboard') document.getElementById('nav-dashboard').classList.add('active');
        if (viewId === 'review') document.getElementById('nav-review').classList.add('active');
        if (viewId === 'chapter' && chapterId) document.getElementById(`nav-ch${chapterId}`).classList.add('active');

        document.querySelectorAll('.view').forEach(v => {
            v.classList.remove('active');
            setTimeout(() => { if(!v.classList.contains('active')) v.classList.add('hidden'); }, 400);
        });

        const target = document.getElementById(viewId === 'chapter' ? 'view-chapter' : (viewId === 'quiz' ? 'view-quiz' : (viewId === 'results' ? 'view-results' : (viewId === 'review' ? 'view-review' : 'view-dashboard'))));
        if (target) {
            target.classList.remove('hidden');
            setTimeout(() => target.classList.add('active'), 50);
        }
        if (viewId === 'dashboard') dashboardController.render();
        if (viewId === 'chapter' && chapterId) chapterController.load(chapterId);
    },
    startExam: () => {
        if(confirm("Lancer l'examen final ?")) {
            document.getElementById('exam-overlay').classList.remove('hidden');
            examEngine.init();
        }
    }
};

const dashboardController = {
    render: () => {
        let totalMastery = 0;
        for (let i = 1; i <= 5; i++) {
            const score = appState.scores[i];
            const percent = score > 0 ? Math.round((score / 35) * 100) : 0;
            appState.mastery[i] = percent; totalMastery += percent;
            const circle = document.getElementById(`prog-ch${i}`);
            if (circle) circle.textContent = `${percent}%`;
        }
        const global = Math.round(totalMastery / 5);
        const masteryEl = document.getElementById('global-mastery');
        masteryEl.textContent = `${global}%`;
        masteryEl.style.color = (global < 50) ? 'var(--error-neon)' : (global < 80 ? 'var(--primary-neon)' : 'var(--success-neon)');
    }
};

const chapterController = {
    load: (id) => {
        chapterController.currentChapter = id;
        const data = rawCourseData[id];
        document.getElementById('ch-title').textContent = `Chapitre 0${id}: ${data.title}`;
        document.getElementById('ch-summary').innerHTML = `<p>${data.summary}</p>`;
        const conceptContainer = document.getElementById('ch-concepts');
        conceptContainer.innerHTML = '';
        data.concepts.forEach(c => {
            const div = document.createElement('div');
            div.className = 'concept-card';
            div.innerHTML = `<div class="concept-title">${c.title}</div><div class="concept-desc">${c.desc}</div>`;
            conceptContainer.appendChild(div);
        });
    }
};

const quizEngine = {
    questions: [], currentIdx: 0, score: 0,
    startQuiz: () => {
        const bank = rawCourseData[chapterController.currentChapter].questions; 
        quizEngine.questions = bank; quizEngine.currentIdx = 0; quizEngine.score = 0;
        router.navigate('quiz');
        quizEngine.renderQuestion();
    },
    renderQuestion: () => {
        const q = quizEngine.questions[quizEngine.currentIdx];
        document.getElementById('quiz-progress-q').textContent = `Question ${quizEngine.currentIdx + 1}/35`;
        document.getElementById('quiz-current-score').textContent = quizEngine.score;
        document.getElementById('quiz-question').textContent = q.q;
        const optsContainer = document.getElementById('quiz-options');
        optsContainer.innerHTML = ''; document.getElementById('quiz-feedback').classList.add('hidden');
        q.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn'; btn.textContent = opt;
            btn.onclick = () => quizEngine.handleAnswer(idx, btn);
            optsContainer.appendChild(btn);
        });
        document.getElementById('quiz-timer').style.width = '0%';
        setTimeout(() => document.getElementById('quiz-timer').style.width = '100%', 100);
    },
    handleAnswer: (selectedIdx, btnElement) => {
        const allBtns = document.querySelectorAll('#quiz-options .option-btn');
        allBtns.forEach(b => b.onclick = null);
        const q = quizEngine.questions[quizEngine.currentIdx];
        const isCorrect = selectedIdx === q.ans;
        if (isCorrect) { btnElement.classList.add('correct'); quizEngine.score++; }
        else { btnElement.classList.add('wrong'); allBtns[q.ans].classList.add('correct'); }
        document.getElementById('quiz-current-score').textContent = quizEngine.score;
        document.getElementById('quiz-feedback').classList.remove('hidden');
    },
    nextQuestion: () => {
        quizEngine.currentIdx++;
        if (quizEngine.currentIdx < quizEngine.questions.length) { quizEngine.renderQuestion(); } else { quizEngine.finish(); }
    },
    finish: () => {
        appState.scores[chapterController.currentChapter] = quizEngine.score;
        document.getElementById('view-quiz').classList.remove('active');
        setTimeout(() => {
            document.getElementById('view-quiz').classList.add('hidden');
            document.getElementById('view-results').classList.remove('hidden');
            setTimeout(() => document.getElementById('view-results').classList.add('active'), 50);
        }, 400);
        resultsController.show(quizEngine.score, 35, 'Chapitre');
    }
};

const examEngine = {
    questions: [], currentIdx: 0, answers: [], timerInterval: null, timeLeft: 5400,
    init: () => {
        let allQ = [];
        for(let i=1; i<=5; i++) allQ = allQ.concat(rawCourseData[i].questions);
        examEngine.questions = allQ.sort(() => 0.5 - Math.random()).slice(0, 100);
        examEngine.currentIdx = 0; examEngine.answers = new Array(100).fill(null); examEngine.timeLeft = 5400;
        examEngine.renderQuestion(); examEngine.startTimer();
    },
    renderQuestion: () => {
        const q = examEngine.questions[examEngine.currentIdx];
        document.getElementById('exam-q-num').textContent = examEngine.currentIdx + 1;
        document.getElementById('exam-question').textContent = q.q;
        const optsContainer = document.getElementById('exam-options');
        optsContainer.innerHTML = '';
        q.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn'; btn.textContent = opt;
            if (examEngine.answers[examEngine.currentIdx] === idx) btn.classList.add('selected');
            btn.onclick = () => {
                document.querySelectorAll('#exam-options .option-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected'); examEngine.answers[examEngine.currentIdx] = idx;
            };
            optsContainer.appendChild(btn);
        });
        const btn = document.getElementById('exam-next-btn');
        btn.textContent = (examEngine.currentIdx === 99) ? "Terminer" : "Suivant";
    },
    startTimer: () => {
        if(examEngine.timerInterval) clearInterval(examEngine.timerInterval);
        examEngine.timerInterval = setInterval(() => {
            examEngine.timeLeft--;
            const m = Math.floor(examEngine.timeLeft / 60).toString().padStart(2, '0');
            const s = (examEngine.timeLeft % 60).toString().padStart(2, '0');
            document.getElementById('exam-timer').textContent = `${m}:${s}`;
            if(examEngine.timeLeft <= 0) examEngine.submit();
        }, 1000);
    },
    nextQuestion: () => {
        if (examEngine.currentIdx === 99) { examEngine.submit(); return; }
        examEngine.currentIdx++; examEngine.renderQuestion();
    },
    toggleNotes: () => { document.getElementById('exam-notes-panel').classList.toggle('active'); },
    submit: () => {
        clearInterval(examEngine.timerInterval);
        if(!confirm("Soumettre ?")) return;
        let correct = 0;
        examEngine.questions.forEach((q, i) => { if (examEngine.answers[i] === q.ans) correct++; });
        document.getElementById('exam-overlay').classList.add('hidden');
        document.getElementById('view-results').classList.remove('hidden');
        setTimeout(() => document.getElementById('view-results').classList.add('active'), 50);
        resultsController.show(correct, 100, 'Examen Final');
    }
};

const resultsController = {
    show: (correct, total, type) => {
        const percentage = Math.round((correct / total) * 100);
        document.getElementById('res-percentage').textContent = `${percentage}%`;
        document.getElementById('res-correct').textContent = correct;
        document.getElementById('res-wrong').textContent = total - correct;
        document.getElementById('res-total').textContent = total;
        let msg = percentage >= 80 ? "Excellente ma√Ætrise." : (percentage >= 50 ? "Ma√Ætrise moyenne." : "Ma√Ætrise faible.");
        let color = percentage >= 80 ? "var(--success-neon)" : (percentage >= 50 ? "var(--primary-neon)" : "var(--error-neon)");
        const msgEl = document.getElementById('res-message');
        msgEl.textContent = msg; msgEl.style.color = color; document.getElementById('res-percentage').style.color = color;
    }
};

function toggleMobileMenu() {
    const sidebar = document.getElementById('main-sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    sidebar.classList.toggle('active');
    overlay.classList.toggle('active');
}

document.addEventListener('DOMContentLoaded', () => { dashboardController.render(); });
</script>
</body>
</html>
