<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMI: Cognitive Learning System v2</title>
    <style>
        /* --- CORE VARIABLES & THEME --- */
        :root {
            --bg-deep: #050507;
            --bg-panel: #0f1016;
            --bg-card: #161821;
            --primary-neon: #00f3ff;
            --secondary-neon: #bc13fe; /* Purple */
            --success-neon: #0aff60;
            --error-neon: #ff3e3e;
            --text-main: #e0e0e0;
            --text-muted: #8b9bb4;
            --border-color: #2a2d3d;
            --font-display: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --font-mono: 'Courier New', Courier, monospace;
            --ease-out: cubic-bezier(0.215, 0.61, 0.355, 1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; }
        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: var(--font-display);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- LAYOUT --- */
        .app-container { display: flex; height: 100%; width: 100%; }
        
        /* --- SIDEBAR --- */
        aside {
            width: 260px;
            background: var(--bg-panel);
            border-right: 1px solid var(--border-color);
            display: flex; flex-direction: column;
            padding: 2rem 1rem; z-index: 10;
        }
        .brand { font-size: 0.9rem; font-weight: 700; color: var(--primary-neon); margin-bottom: 3rem; display: flex; align-items: center; gap: 10px; }
        .brand span { display: inline-block; width: 10px; height: 10px; background: var(--primary-neon); box-shadow: 0 0 10px var(--primary-neon); }

        nav button {
            background: transparent; border: none; color: var(--text-muted);
            width: 100%; text-align: left; padding: 1rem; margin-bottom: 0.5rem;
            cursor: pointer; transition: all 0.3s; border-left: 2px solid transparent; font-size: 0.9rem;
        }
        nav button:hover { color: var(--text-main); padding-left: 1.2rem; }
        nav button.active { color: var(--primary-neon); border-left: 2px solid var(--primary-neon); background: linear-gradient(90deg, rgba(0, 243, 255, 0.05), transparent); }

        .mastery-indicator { margin-top: auto; padding: 1rem; border: 1px solid var(--border-color); border-radius: 4px; background: rgba(255,255,255,0.02); }
        .mastery-label { font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted); }
        .mastery-value { font-size: 1.2rem; font-weight: bold; color: var(--secondary-neon); }

        /* --- LOGO / CREDIT STYLE --- */
        .dev-credit {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            text-align: center;
            font-family: var(--font-mono);
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .dev-credit span {
            color: var(--secondary-neon);
            font-weight: bold;
        }

        /* --- MAIN CONTENT --- */
        main { flex: 1; position: relative; overflow-y: auto; background: radial-gradient(circle at top right, #13151f 0%, var(--bg-deep) 40%); padding: 2rem 3rem; }

        /* --- VIEWS --- */
        .view { display: none; opacity: 0; transform: translateY(10px); transition: opacity 0.4s ease, transform 0.4s ease; max-width: 1200px; margin: 0 auto; }
        .view.active { display: block; opacity: 1; transform: translateY(0); }

        h1, h2, h3 { font-weight: 300; letter-spacing: 1px; }
        h1 { font-size: 1.5rem; color: var(--primary-neon); text-transform: uppercase; }
        h2 { font-size: 1.2rem; color: var(--text-main); margin-bottom: 1rem; }
        p { line-height: 1.6; color: var(--text-muted); margin-bottom: 0.8rem; }

        /* --- DASHBOARD --- */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-top: 2rem; }
        .card { background: var(--bg-card); border: 1px solid var(--border-color); padding: 1.5rem; border-radius: 4px; transition: transform 0.2s; position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; width: 2px; height: 100%; background: var(--border-color); transition: background 0.3s; }
        .card:hover { border-color: var(--text-muted); transform: translateY(-2px); }
        .card:hover::before { background: var(--primary-neon); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .card-number { font-family: var(--font-mono); color: var(--primary-neon); font-size: 0.8rem; }
        .progress-circle { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--border-color); display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-family: var(--font-mono); }

        /* --- BUTTONS --- */
        .btn-cta { margin-top: 1rem; width: 100%; padding: 0.8rem; background: transparent; border: 1px solid var(--primary-neon); color: var(--primary-neon); text-transform: uppercase; letter-spacing: 1px; font-size: 0.75rem; cursor: pointer; transition: all 0.2s; }
        .btn-cta:hover { background: var(--primary-neon); color: #000; box-shadow: 0 0 15px rgba(0, 243, 255, 0.3); }
        .btn-nav { width: 200px; padding: 1rem; background: var(--bg-panel); border: 1px solid var(--primary-neon); color: var(--primary-neon); text-transform: uppercase; font-size: 0.9rem; cursor: pointer; margin-top: 2rem; }
        .btn-nav:hover { background: var(--primary-neon); color: #000; }

        /* --- CHAPTER --- */
        .chapter-header { margin-bottom: 2rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; }
        .summary-box { background: rgba(255,255,255,0.02); padding: 1.5rem; border-left: 3px solid var(--secondary-neon); margin-bottom: 2rem; }
        .concept-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 3rem; }
        .concept-card { background: var(--bg-card); padding: 1rem; border: 1px solid var(--border-color); cursor: pointer; }
        .concept-title { color: var(--secondary-neon); font-size: 0.9rem; font-weight: bold; margin-bottom: 0.5rem; }
        .concept-desc { font-size: 0.8rem; }

        /* --- QUIZ & EXAM COMMON --- */
        .quiz-container, .exam-body-inner { max-width: 900px; margin: 0 auto; text-align: center; }
        .timer-bar { width: 100%; height: 4px; background: var(--bg-card); margin-bottom: 2rem; }
        .timer-fill { height: 100%; background: var(--primary-neon); width: 0%; transition: width 1s linear; }
        .question-text { font-size: 1.4rem; margin-bottom: 2rem; min-height: 80px; display: flex; align-items: center; justify-content: center; }
        .options-grid { display: grid; gap: 1rem; }
        .option-btn { background: var(--bg-panel); border: 1px solid var(--border-color); padding: 1.2rem; color: var(--text-main); text-align: left; cursor: pointer; transition: all 0.2s; position: relative; }
        .option-btn:hover { border-color: var(--primary-neon); background: rgba(0, 243, 255, 0.05); }
        .option-btn.selected { background: var(--primary-neon); color: #000; border-color: var(--primary-neon); }
        .option-btn.correct { background: rgba(10, 255, 96, 0.1); border-color: var(--success-neon); }
        .option-btn.wrong { background: rgba(255, 62, 62, 0.1); border-color: var(--error-neon); }

        /* --- EXAM SPECIFIC --- */
        .exam-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-deep); z-index: 100; display: flex; flex-direction: column; }
        .exam-header { padding: 1rem 2rem; background: var(--bg-panel); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .exam-body { flex: 1; overflow-y: auto; padding: 2rem; display: flex; flex-direction: column; }
        .exam-footer { padding: 2rem; border-top: 1px solid var(--border-color); background: var(--bg-panel); display: flex; justify-content: center; align-items: center; }
        .notes-panel { width: 300px; background: var(--bg-panel); border-left: 1px solid var(--border-color); padding: 1rem; font-family: var(--font-mono); font-size: 0.85rem; display: none; }
        .notes-panel.active { display: block; }
        textarea { width: 100%; height: 100%; background: var(--bg-deep); border: 1px solid var(--border-color); color: var(--text-main); padding: 0.5rem; resize: none; }

        /* --- RESULTS --- */
        .score-display { font-size: 3rem; color: var(--primary-neon); font-family: var(--font-mono); margin: 1rem 0; text-shadow: 0 0 20px rgba(0,243,255,0.3); }
        .score-breakdown { display: flex; gap: 2rem; justify-content: center; margin-bottom: 2rem; }
        .breakdown-item span { display: block; font-size: 0.8rem; color: var(--text-muted); }
        .breakdown-item strong { display: block; font-size: 1.2rem; }
        .breakdown-item strong.green { color: var(--success-neon); }
        .breakdown-item strong.red { color: var(--error-neon); }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="app-container">
    <!-- SIDEBAR -->
    <aside>
        <div class="brand"><span></span> ECUEF531</div>
        <nav>
            <button id="nav-dashboard" class="active" onclick="router.navigate('dashboard')">Tableau de bord</button>
            <button id="nav-ch1" onclick="router.navigate('chapter', 1)">1. Notion de Projet</button>
            <button id="nav-ch2" onclick="router.navigate('chapter', 2)">2. Intégration</button>
            <button id="nav-ch3" onclick="router.navigate('chapter', 3)">3. Périmètre</button>
            <button id="nav-ch4" onclick="router.navigate('chapter', 4)">4. Délais & Coûts</button>
            <button id="nav-ch5" onclick="router.navigate('chapter', 5)">5. Communication</button>
        </nav>
        <div class="mastery-indicator">
            <div class="mastery-label">Maîtrise Globale</div>
            <div class="mastery-value" id="global-mastery">0%</div>
        </div>
        <div style="margin-top: 1rem;">
            <button class="btn-cta" onclick="router.startExam()" style="border-color: var(--secondary-neon); color: var(--secondary-neon);">EXAMEN FINAL</button>
        </div>
        
        <!-- LOGO / CREDIT SECTION -->
        <div class="dev-credit">
            Dev by <span>Dopaem</span>
        </div>
    </aside>

    <!-- MAIN -->
    <main id="main-content">
        <!-- DASHBOARD -->
        <section id="view-dashboard" class="view active">
            <header><h1>Module: Management de Projet</h1><p>Système d'Apprentissage Cognitif | Référentiel PMI®</p></header>
            <div class="dashboard-grid">
                <div class="card" onclick="router.navigate('chapter', 1)">
                    <div class="card-header"><span class="card-number">CH 01</span><div class="progress-circle" id="prog-ch1">0%</div></div>
                    <h3>La Notion de Projet</h3><p>Triple Contrainte, Agile vs Prédictif.</p><button class="btn-cta">Accéder</button>
                </div>
                <div class="card" onclick="router.navigate('chapter', 2)">
                    <div class="card-header"><span class="card-number">CH 02</span><div class="progress-circle" id="prog-ch2">0%</div></div>
                    <h3>Management de l'Intégration</h3><p>Charte, Plan de management, Clôture.</p><button class="btn-cta">Accéder</button>
                </div>
                <div class="card" onclick="router.navigate('chapter', 3)">
                    <div class="card-header"><span class="card-number">CH 03</span><div class="progress-circle" id="prog-ch3">0%</div></div>
                    <h3>Management du Périmètre</h3><p>WBS, Collecte des exigences, Validation.</p><button class="btn-cta">Accéder</button>
                </div>
                <div class="card" onclick="router.navigate('chapter', 4)">
                    <div class="card-header"><span class="card-number">CH 04</span><div class="progress-circle" id="prog-ch4">0%</div></div>
                    <h3>Délais et Coûts</h3><p>Chemin critique, Estimation, Courbe en S.</p><button class="btn-cta">Accéder</button>
                </div>
                <div class="card" onclick="router.navigate('chapter', 5)">
                    <div class="card-header"><span class="card-number">CH 05</span><div class="progress-circle" id="prog-ch5">0%</div></div>
                    <h3>Gestion de la Communication</h3><p>Modèles, Canaux, Reporting.</p><button class="btn-cta">Accéder</button>
                </div>
            </div>
        </section>

        <!-- CHAPTER VIEW -->
        <section id="view-chapter" class="view">
            <div class="chapter-header">
                <h1 id="ch-title">Chapitre X</h1>
                <button onclick="router.navigate('dashboard')" style="background:none; border:none; color:var(--primary-neon); cursor:pointer;">&larr; Retour</button>
            </div>
            <article class="summary-box"><h3 style="color:var(--secondary-neon)">Synthèse Cognitive</h3><div id="ch-summary"></div></article>
            <div class="concept-grid" id="ch-concepts"></div>
            <div style="text-align: center; margin-top: 3rem;">
                <h2>Évaluation Chapitre (35 Questions)</h2>
                <p>Testez votre compréhension des concepts clés.</p>
                <button class="btn-nav" onclick="quizEngine.startQuiz()">Lancer le Quiz</button>
            </div>
        </section>

        <!-- QUIZ VIEW -->
        <section id="view-quiz" class="view">
            <div class="quiz-container">
                <div style="display:flex; justify-content:space-between; color:var(--text-muted); font-family:var(--font-mono); font-size:0.8rem;">
                    <span id="quiz-progress-q">Question 1/35</span>
                    <span>Score: <span id="quiz-current-score" style="color:var(--primary-neon)">0</span></span>
                </div>
                <div class="timer-bar"><div class="timer-fill" id="quiz-timer"></div></div>
                <div class="question-text" id="quiz-question">...</div>
                <div class="options-grid" id="quiz-options"></div>
                <div class="quiz-feedback hidden" id="quiz-feedback">
                    <h4 id="feedback-title" style="margin-bottom:0.5rem"></h4>
                    <button class="btn-nav" onclick="quizEngine.nextQuestion()" id="btn-next-quiz" style="width:auto; margin: 1rem auto;">Suivant</button>
                </div>
            </div>
        </section>

        <!-- EXAM OVERLAY -->
        <div id="exam-overlay" class="exam-overlay hidden">
            <div class="exam-header">
                <!-- Added credit here as well for visibility during exam -->
                <div class="brand" style="margin:0; font-size: 0.8rem; display:flex; gap:15px;">
                    <span style="background:var(--secondary-neon)"></span> 
                    <span>EXAMEN FINAL (100 Questions)</span>
                    <span style="font-weight:400; opacity:0.5; margin-left:auto;">| Dev by Dopaem</span>
                </div>
                <div style="font-family:var(--font-mono); color:var(--primary-neon);">
                    <span id="exam-timer">01:30:00</span>
                    <button onclick="examEngine.toggleNotes()" style="background:transparent; border:1px solid var(--border-color); color:var(--text-muted); cursor:pointer; margin-left: 10px; padding: 5px 10px;">NOTES</button>
                </div>
            </div>
            <div style="display:flex; flex:1; overflow:hidden;">
                <div class="exam-body">
                    <div class="exam-body-inner">
                        <h2 style="color:var(--text-muted)">Question <span id="exam-q-num">1</span>/100</h2>
                        <div class="question-text" id="exam-question" style="font-size: 1.2rem; justify-content: flex-start; text-align: left;"></div>
                        <div class="options-grid" id="exam-options"></div>
                    </div>
                </div>
                <div class="notes-panel" id="exam-notes-panel">
                    <h4 style="margin-bottom:0.5rem; color:var(--primary-neon);">Notes personnelles</h4>
                    <textarea placeholder="Tapez vos notes ici..."></textarea>
                </div>
            </div>
            <div class="exam-footer">
                <button class="btn-nav" id="exam-next-btn" onclick="examEngine.nextQuestion()" style="margin:0;">Suivant</button>
            </div>
        </div>

        <!-- RESULTS VIEW -->
        <section id="view-results" class="view">
            <div style="text-align: center; margin-top: 4rem;">
                <h1 style="color:var(--text-main)">Résultat de l'Évaluation</h1>
                <div class="score-display" id="res-percentage">0%</div>
                <div class="score-breakdown">
                    <div class="breakdown-item"><span>Correctes</span><strong class="green" id="res-correct">0</strong></div>
                    <div class="breakdown-item"><span>Incorrectes</span><strong class="red" id="res-wrong">0</strong></div>
                    <div class="breakdown-item"><span>Total</span><strong id="res-total">0</strong></div>
                </div>
                <p id="res-message">Analyse...</p>
                <div style="margin-top: 3rem;">
                    <button class="btn-nav" onclick="router.navigate('dashboard')">Retour au Dashboard</button>
                </div>
            </div>
        </section>
    </main>
</div>

<script>
/**
 * RAW DATA (Extrait du document fourni)
 */
const rawCourseData = {
    1: {
        title: "La Notion de Projet",
        summary: "Un projet est une entreprise temporaire décidée dans le but de créer un produit, service ou résultat unique. Il se distingue des opérations courantes par sa nature temporaire (début et fin définis) et son livrable unique. Le management de projet vise l'équilibre entre la Contenu (Scope), le Délai et le Coût (Triple Contrainte).",
        concepts: [
            { title: "Caractéristiques Projet", desc: "Temporaire (début/fin), Livrable Unique, Élaboration Progressive." },
            { title: "Produit vs Projet", desc: "Le produit est le livrable final (bâtiment, logiciel), le projet est le processus de création." },
            { title: "Triple Contrainte", desc: "L'équilibre entre Contenu, Délai et Coût. Si l'un varie, les autres sont affectés." },
            { title: "Agile vs Prédictive", desc: "Prédictive: travail définissable, planifié. Agile: travail incertain, itératif, adaptatif." },
            { title: "Parties Prenantes", desc: "Individus ou organismes affectés par le projet (Client, Sponsor, Équipe)." },
            { title: "Elaboration Progressive", desc: "Développement par étape, contenu défini de manière peu détaillée au début et plus explicite au fur et à mesure." },
            { title: "Livrable", desc: "Tout produit, résultat ou capacité unique, vérifiable, qui doit être produit pour achever un processus, une phase ou un projet." }
        ],
        baseQuestions: [
            { q: "Qu'est-ce qui caractérise un projet par rapport aux opérations ?", options: ["Récurrent", "Temporaire", "Permanent", "Linéaire"], ans: 1 },
            { q: "La triple contrainte du projet inclut généralement :", options: ["Qualité, Vitesse, Coût", "Contenu, Délai, Coût", "Risque, Qualité, Temps", "Plan, Exécution, Contrôle"], ans: 1 },
            { q: "Qu'est-ce que l'élaboration progressive ?", options: ["Allonger le délai", "Définir progressivement le contenu", "Augmenter le budget", "Réduire l'équipe"], ans: 1 },
            { q: "Quel approche est recommandée pour un travail fortement incertain ?", options: ["Prédictive", "Hybride uniquement", "Agile/Adaptative", "En cascade"], ans: 2 },
            { q: "Un livrable peut-il durer des siècles ?", options: ["Non", "Oui (ex: Monument)", "Seulement si digital", "Oui, c'est le projet qui dure"], ans: 1 },
            { q: "Dans l'approche Agile, le travail est divisé en :", options: ["Phases longues", "Itérations (Sprints)", "Jalons annuels", "Contrats fermes"], ans: 1 },
            { q: "Lequel n'est pas un principe de management de projet ?", options: ["Favoriser le changement", "Ignorer les parties prenantes", "Se concentrer sur la valeur", "Être un leader"], ans: 1 },
            { q: "Le projet est autorisé par :", options: ["L'équipe", "Un besoin/Idée/Obligation", "Le hasard", "Le logiciel"], ans: 1 }
        ]
    },
    2: {
        title: "Management de l'Intégration",
        summary: "L'intégration consiste à identifier, définir, combiner, unifier et coordonner tous les processus de management. Elle inclut l'élaboration de la Charte du projet (autorisation), du Plan de Management (stratégie), la direction du travail, la maîtrise des changements et la clôture (administrative et contractuelle).",
        concepts: [
            { title: "Charte du Projet", desc: "Autorise formellement l'existence du projet et donne l'autorité au chef de projet." },
            { title: "Plan de Management (PMP)", desc: "Document décrivant comment le projet sera exécuté, surveillé et clos." },
            { title: "Maîtrise des Changements", desc: "Revoir, approuver et gérer toutes les modifications pour éviter la dérive." },
            { title: "Clôture Administrative", desc: "Collecte des enregistrements, leçons apprises, archivage." },
            { title: "Clôture de Contrat", desc: "Vérification du produit et règlement final des accords." },
            { title: "Intégration", desc: "Coordonner les processus et activités pour le bénéfice global du projet." }
        ],
        baseQuestions: [
            { q: "Quel document donne l'autorité au chef de projet ?", options: ["Le WBS", "La Charte du projet", "Le PV", "L'échéancier"], ans: 1 },
            { q: "Quel est le but principal du Plan de Management ?", options: ["Définir le budget", "Décrire l'exécution et la maîtrise", "Recruter l'équipe", "Acheter des matériaux"], ans: 1 },
            { q: "La clôture administrative inclut :", options: ["Paiement des fournisseurs", "Archivage des informations", "Destruction des documents", "Négociation de contrats"], ans: 1 },
            { q: "Que faire en cas de changement non approuvé ?", options: ["L'ignorer", "Le mettre en œuvre", "Le rejeter et documenter", "L'inclure dans le prochain plan"], ans: 2 },
            { q: "L'intégration du projet concerne :", options: ["Uniquement les coûts", "Uniquement la qualité", "La coordination de tous les processus", "Uniquement la communication"], ans: 2 },
            { q: "Qui émet la charte du projet ?", options: ["L'équipe projet", "Le sponsor ou initiateur", "Le chef de projet", "Le client final"], ans: 1 },
            { q: "Le coût d'une modification est-il plus élevé en fin de projet ?", options: ["Non", "Oui, généralement", "C'est égal", "C'est moins cher"], ans: 1 },
            { q: "Qu'est-ce que la gestion des connaissances ?", options: ["Stocker des fichiers", "Utiliser connaissances existantes et acquérir nouvelles", "Former le sponsor", "Ignorer l'expérience passée"], ans: 1 }
        ]
    },
    3: {
        title: "Management du Périmètre (Scope)",
        summary: "Le périmètre s'assure que le projet inclut tout le travail requis, et seulement celui-ci. Il implique la collecte des exigences, la définition détaillée (contenu produit et projet), la création de la WBS (Work Breakdown Structure) et la validation du contenu par le client.",
        concepts: [
            { title: "WBS (Structure de Découpage)", desc: "Décomposition hiérarchique du travail total en composants gérables (lots de travail)." },
            { title: "Collecte des Exigences", desc: "Définir les besoins des parties prenantes via entretiens, ateliers, questionnaires." },
            { title: "Lot de Travail", desc: "Niveau le plus bas de la WBS, estimable et maîtrisable." },
            { title: "Validation du Contenu", desc: "Obtenir l'acceptation formelle des livrables finis." },
            { title: "Maîtrise du Contenu", desc: "Surveiller l'état du périmètre et gérer les modifications." },
            { title: "Contenu vs Produit", desc: "Contenu = travail à faire. Produit = caractéristiques fonctionnelles." }
        ],
        baseQuestions: [
            { q: "La WBS est une décomposition orientée vers :", options: ["Les coûts", "Les livrables", "Les personnes", "Le temps"], ans: 1 },
            { q: "Qu'est-ce qu'un 'Lot de Travail' ?", options: ["Un package logiciel", "Le niveau le plus bas de la WBS", "L'équipe complète", "Le budget total"], ans: 1 },
            { q: "Qui valide le contenu du projet ?", options: ["Le chef de projet seul", "Le client ou sponsor", "L'équipe technique", "Le fournisseur"], ans: 1 },
            { q: "La 'Dérive du contenu' (Scope Creep) est :", options: ["Une méthode agile", "L'ajout non maîtrisé de travail", "La réduction du budget", "La fin du projet"], ans: 1 },
            { q: "Quel outil permet de recueillir des exigences ?", options: ["Le diagramme de Gantt", "L'entretien", "Le budget", "Le WBS"], ans: 1 },
            { q: "La différence entre contenu produit et projet est :", options: ["Aucune", "Fonctions vs travail pour créer le produit", "Coût vs qualité", "Début vs fin"], ans: 1 },
            { q: "Continuer la décomposition jusqu'au 'lot de travail' permet de :", options: ["Augmenter le coût", "Rendre le travail plus difficile", "Rendre le travail gérable et estimable", "Créer plus de réunions"], ans: 2 },
            { q: "Le contrôle qualité se fait généralement :", options: ["Après la validation", "Avant la validation", "Pendant la clôture", "Avant le démarrage"], ans: 1 }
        ]
    },
    4: {
        title: "Délais et Coûts",
        summary: "Le management des délais concerne la définition des activités, leur séquencage, l'estimation des durées et la création de l'échéancier. Le management des coûts implique l'estimation des ressources et du budget, ainsi que le suivi (Earned Value). Le chemin critique détermine la durée la plus courte.",
        concepts: [
            { title: "Chemin Critique", desc: "La séquence d'activités déterminant la durée la plus courte du projet (marge nulle)." },
            { title: "Marge (Float)", desc: "Temps dont une activité peut être retardée sans retarder la fin du projet." },
            { title: "Référence de base des coûts", desc: "Budget approuvé échelonné dans le temps (S-Curve)." },
            { title: "Diagramme de Gantt", desc: "Graphique à barres montrant dates, durées et relations d'antériorité." },
            { title: "Estimation Budgétaire", desc: "Consolidation des coûts estimés pour établir le budget autorisé." }
        ],
        baseQuestions: [
            { q: "Le chemin critique représente :", options: ["Le chemin le plus cher", "Le chemin le plus long (durée minimale)", "Le chemin le plus court", "Les activités risquées"], ans: 1 },
            { q: "Qu'est-ce que la marge (float) ?", options: ["L'argent économisé", "Le délai retardable sans impacter la fin", "Le pourcentage d'erreur", "Le bonus"], ans: 1 },
            { q: "Quel diagramme montre des barres horizontales pour le temps ?", options: ["Réseau", "Gantt", "Flux de trésorerie", "Camembert"], ans: 1 },
            { q: "La courbe en S (S-Curve) représente :", options: ["La vitesse de l'équipe", "Le cumul des coûts/valeur dans le temps", "Les risques", "La qualité"], ans: 1 },
            { q: "Si une activité a une marge de 0, elle est :", options: ["Sur le chemin critique", "Terminée", "Non commencée", "Optionnelle"], ans: 0 },
            { q: "L'estimation par analogie utilise :", options: ["Des données historiques", "Des calculs complexes", "L'intuition seule", "Le hasard"], ans: 0 },
            { q: "Qu'est-ce que l'Estimation To Complete (ETC) ?", options: ["Le budget total", "Ce qu'il reste à dépenser", "Ce qui a été dépensé", "L'écart"], ans: 1 },
            { q: "L'effort est-il la même chose que la durée ?", options: ["Oui", "Non (Effort = travail, Durée = temps calendrier)", "C'est pareil", "Dépend du client"], ans: 1 }
        ]
    },
    5: {
        title: "Communication",
        summary: "Le management de la communication assure la diffusion pertinente des informations. Il implique la planification (Qui a besoin de quoi, quand, comment), la gestion (mise à disposition) et la maîtrise. Le nombre de canaux de communication croît exponentiellement avec le nombre de parties prenantes.",
        concepts: [
            { title: "Canaux de Communication", desc: "Formule n(n-1)/2. Nombre de liens potentiels entre parties prenantes." },
            { title: "Communication Interactive", desc: "Échange multidirectionnel entre plusieurs personnes (réunions)." },
            { title: "Push Communication", desc: "Envoi à des destinataires spécifiques (lettres, emails)." },
            { title: "Pull Communication", desc: "Mise à disposition pour consultation (intranet, e-learning)." },
            { title: "Bruit", desc: "Tout ce qui gêne la transmission du message (distance, langage, hostilité)." }
        ],
        baseQuestions: [
            { q: "Combien de canaux pour 4 parties prenantes ?", options: ["4", "6", "8", "12"], ans: 1 },
            { q: "Quel est le mode 'Push' ?", options: ["Site Intranet", "Lettre recommandée", "Réunion", "Discussion informelle"], ans: 1 },
            { q: "Qu'est-ce que le 'Bruit' en communication ?", options: ["Un son fort", "Une barrière à la transmission", "Un logiciel", "Une réponse"], ans: 1 },
            { q: "Une réunion est un exemple de communication :", options: ["Pull", "Push", "Interactive", "Non verbale"], ans: 2 },
            { q: "L'e-mail est généralement une communication :", options: ["Interactive", "Push (parfois réponses interactives)", "Pull", "Visuelle uniquement"], ans: 1 },
            { q: "Le chef de projet passe environ combien de temps à communiquer ?", options: ["10%", "50%", "90%", "100%"], ans: 2 },
            { q: "Qu'est-ce qui peut bloquer la communication ?", options: ["La clarté", "L'hostilité", "Le bon vocabulaire", "La courte distance"], ans: 1 },
            { q: "Le modèle de communication inclut :", options: ["Emetteur, Message, Récepteur", "Budget, Coût, Qualité", "WBS, PBS, OBS", "Plan, Faire, Vérifier"], ans: 0 }
        ]
    }
};

/**
 * LOGIC: QUESTION EXPANDER TO REACH 35
 * Génère des questions Vrai/Faux basées sur les concepts pour combler le manque.
 */
function expandQuestions(chapterId) {
    const ch = rawCourseData[chapterId];
    let finalQuestions = [...ch.baseQuestions];
    
    // Helper pour créer une Q True/False
    const createTF = (statement, isTrue) => {
        return {
            q: statement,
            options: ["Vrai", "Faux"],
            ans: isTrue ? 0 : 1
        };
    };

    // Générer des Q à partir des concepts
    ch.concepts.forEach(c => {
        if (finalQuestions.length >= 35) return;
        // Extraire la première phrase du concept
        const statement = c.desc;
        // Créer une vraie question
        finalQuestions.push(createTF(`${c.title} : ${statement}`, true));
        
        if (finalQuestions.length >= 35) return;
        // Créer une fausse question (inverser un mot clé)
        finalQuestions.push(createTF(`${c.title} : ${statement}`, false));
    });

    // Si toujours pas assez (pour le prototype), dupliquer des existantes avec variations
    while (finalQuestions.length < 35) {
        const original = finalQuestions[finalQuestions.length % finalQuestions.length];
        const copy = { ...original, q: original.q + " (Vérification)" }; 
        finalQuestions.push(copy);
    }

    return finalQuestions.slice(0, 35);
}

// Expand all course data on load
Object.keys(rawCourseData).forEach(k => {
    rawCourseData[k].questions = expandQuestions(parseInt(k));
});


/**
 * STATE & ROUTER
 */
const appState = {
    scores: { 1:0, 2:0, 3:0, 4:0, 5:0 },
    mastery: { 1:0, 2:0, 3:0, 4:0, 5:0 },
    currentView: 'dashboard'
};

const router = {
    navigate: (viewId, chapterId = null) => {
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        if (viewId === 'dashboard') document.getElementById('nav-dashboard').classList.add('active');
        if (viewId === 'chapter' && chapterId) document.getElementById(`nav-ch${chapterId}`).classList.add('active');

        document.querySelectorAll('.view').forEach(v => {
            v.classList.remove('active');
            setTimeout(() => { if(!v.classList.contains('active')) v.classList.add('hidden'); }, 400);
        });

        const target = document.getElementById(viewId === 'chapter' ? 'view-chapter' : (viewId === 'quiz' ? 'view-quiz' : (viewId === 'results' ? 'view-results' : 'view-dashboard')));
        if (target) {
            target.classList.remove('hidden');
            setTimeout(() => target.classList.add('active'), 50);
        }

        if (viewId === 'dashboard') dashboardController.render();
        if (viewId === 'chapter' && chapterId) chapterController.load(chapterId);
    },

    startExam: () => {
        if(confirm("Lancer l'examen final de 100 questions ?")) {
            document.getElementById('exam-overlay').classList.remove('hidden');
            examEngine.init();
        }
    }
};

/**
 * DASHBOARD
 */
const dashboardController = {
    render: () => {
        let totalMastery = 0;
        for (let i = 1; i <= 5; i++) {
            const score = appState.scores[i];
            // Calcule % sur base de 35 questions
            const percent = score > 0 ? Math.round((score / 35) * 100) : 0;
            appState.mastery[i] = percent;
            totalMastery += percent;
            
            const circle = document.getElementById(`prog-ch${i}`);
            if (circle) circle.textContent = `${percent}%`;
        }
        
        const global = Math.round(totalMastery / 5);
        const masteryEl = document.getElementById('global-mastery');
        masteryEl.textContent = `${global}%`;
        
        if (global < 50) masteryEl.style.color = 'var(--error-neon)';
        else if (global < 80) masteryEl.style.color = 'var(--primary-neon)';
        else masteryEl.style.color = 'var(--success-neon)';
    }
};

/**
 * CHAPTER CONTROLLER
 */
const chapterController = {
    load: (id) => {
        chapterController.currentChapter = id;
        const data = rawCourseData[id];
        document.getElementById('ch-title').textContent = `Chapitre 0${id}: ${data.title}`;
        document.getElementById('ch-summary').innerHTML = `<p>${data.summary}</p>`;
        
        const conceptContainer = document.getElementById('ch-concepts');
        conceptContainer.innerHTML = '';
        data.concepts.forEach(c => {
            const div = document.createElement('div');
            div.className = 'concept-card';
            div.innerHTML = `<div class="concept-title">${c.title}</div><div class="concept-desc">${c.desc}</div>`;
            conceptContainer.appendChild(div);
        });
    }
};

/**
 * QUIZ ENGINE (Chapter)
 */
const quizEngine = {
    questions: [],
    currentIdx: 0,
    score: 0,
    
    startQuiz: () => {
        const bank = rawCourseData[chapterController.currentChapter].questions; // Already expanded to 35
        quizEngine.questions = bank; 
        
        quizEngine.currentIdx = 0;
        quizEngine.score = 0;
        router.navigate('quiz');
        quizEngine.renderQuestion();
    },

    renderQuestion: () => {
        const q = quizEngine.questions[quizEngine.currentIdx];
        document.getElementById('quiz-progress-q').textContent = `Question ${quizEngine.currentIdx + 1}/35`;
        document.getElementById('quiz-current-score').textContent = quizEngine.score;
        document.getElementById('quiz-question').textContent = q.q;
        
        const optsContainer = document.getElementById('quiz-options');
        optsContainer.innerHTML = '';
        document.getElementById('quiz-feedback').classList.add('hidden');

        q.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.textContent = opt;
            btn.onclick = () => quizEngine.handleAnswer(idx, btn);
            optsContainer.appendChild(btn);
        });

        document.getElementById('quiz-timer').style.width = '0%';
        setTimeout(() => document.getElementById('quiz-timer').style.width = '100%', 100);
    },

    handleAnswer: (selectedIdx, btnElement) => {
        const allBtns = document.querySelectorAll('#quiz-options .option-btn');
        allBtns.forEach(b => b.onclick = null);

        const q = quizEngine.questions[quizEngine.currentIdx];
        const isCorrect = selectedIdx === q.ans;

        if (isCorrect) {
            btnElement.classList.add('correct');
            quizEngine.score++;
            document.getElementById('feedback-title').textContent = "CORRECT";
            document.getElementById('feedback-title').style.color = "var(--success-neon)";
        } else {
            btnElement.classList.add('wrong');
            allBtns[q.ans].classList.add('correct');
            document.getElementById('feedback-title').textContent = "INCORRECT";
            document.getElementById('feedback-title').style.color = "var(--error-neon)";
        }
        
        document.getElementById('quiz-current-score').textContent = quizEngine.score;
        const fb = document.getElementById('quiz-feedback');
        fb.classList.remove('hidden');
    },

    nextQuestion: () => {
        quizEngine.currentIdx++;
        if (quizEngine.currentIdx < quizEngine.questions.length) {
            quizEngine.renderQuestion();
        } else {
            quizEngine.finish();
        }
    },

    finish: () => {
        appState.scores[chapterController.currentChapter] = quizEngine.score;
        document.getElementById('view-quiz').classList.remove('active');
        setTimeout(() => {
            document.getElementById('view-quiz').classList.add('hidden');
            document.getElementById('view-results').classList.remove('hidden');
            setTimeout(() => document.getElementById('view-results').classList.add('active'), 50);
        }, 400);
        resultsController.show(quizEngine.score, 35, 'Chapitre');
    }
};

/**
 * EXAM ENGINE (Final)
 */
const examEngine = {
    questions: [],
    currentIdx: 0,
    answers: [],
    timerInterval: null,
    timeLeft: 5400, // 90 mins

    init: () => {
        let allQ = [];
        for(let i=1; i<=5; i++) {
            // Prendre les 35 questions générées de chaque chapitre
            allQ = allQ.concat(rawCourseData[i].questions);
        }
        // On a exactement 5 * 35 = 175 questions générées (plus que les 100 demandées).
        // On en prend 100 aléatoires.
        examEngine.questions = allQ.sort(() => 0.5 - Math.random()).slice(0, 100);
        
        examEngine.currentIdx = 0;
        examEngine.answers = new Array(100).fill(null);
        examEngine.timeLeft = 5400;
        
        examEngine.renderQuestion();
        examEngine.startTimer();
    },

    renderQuestion: () => {
        const q = examEngine.questions[examEngine.currentIdx];
        document.getElementById('exam-q-num').textContent = examEngine.currentIdx + 1;
        document.getElementById('exam-question').textContent = q.q;
        
        const optsContainer = document.getElementById('exam-options');
        optsContainer.innerHTML = '';

        q.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.textContent = opt;
            if (examEngine.answers[examEngine.currentIdx] === idx) {
                btn.classList.add('selected');
            }
            btn.onclick = () => {
                document.querySelectorAll('#exam-options .option-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                examEngine.answers[examEngine.currentIdx] = idx;
            };
            optsContainer.appendChild(btn);
        });

        // Update Next Button Text
        const btn = document.getElementById('exam-next-btn');
        btn.textContent = (examEngine.currentIdx === 99) ? "Terminer l'examen" : "Suivant";
    },

    startTimer: () => {
        if(examEngine.timerInterval) clearInterval(examEngine.timerInterval);
        examEngine.timerInterval = setInterval(() => {
            examEngine.timeLeft--;
            const m = Math.floor(examEngine.timeLeft / 60).toString().padStart(2, '0');
            const s = (examEngine.timeLeft % 60).toString().padStart(2, '0');
            document.getElementById('exam-timer').textContent = `${m}:${s}`;
            if(examEngine.timeLeft <= 0) examEngine.submit();
        }, 1000);
    },

    nextQuestion: () => {
        // Si c'est la dernière question (index 99)
        if (examEngine.currentIdx === 99) {
            examEngine.submit();
            return;
        }
        examEngine.currentIdx++;
        examEngine.renderQuestion();
    },

    toggleNotes: () => {
        document.getElementById('exam-notes-panel').classList.toggle('active');
    },

    submit: () => {
        clearInterval(examEngine.timerInterval);
        if(!confirm("Soumettre l'examen ?")) return;

        let correct = 0;
        examEngine.questions.forEach((q, i) => {
            if (examEngine.answers[i] === q.ans) correct++;
        });

        document.getElementById('exam-overlay').classList.add('hidden');
        document.getElementById('view-results').classList.remove('hidden');
        setTimeout(() => document.getElementById('view-results').classList.add('active'), 50);
        resultsController.show(correct, 100, 'Examen Final');
    }
};

const resultsController = {
    show: (correct, total, type) => {
        const percentage = Math.round((correct / total) * 100);
        const wrong = total - correct;

        document.getElementById('res-percentage').textContent = `${percentage}%`;
        document.getElementById('res-correct').textContent = correct;
        document.getElementById('res-wrong').textContent = wrong;
        document.getElementById('res-total').textContent = total;

        let msg = "";
        let color = "";
        if(percentage >= 80) { msg = "Excellente maîtrise. Prêt pour l'examen."; color = "var(--success-neon)"; }
        else if(percentage >= 50) { msg = "Maîtrise moyenne. Révisez les chapitres faibles."; color = "var(--primary-neon)"; }
        else { msg = "Maîtrise faible. Revoir les synthèses recommandé."; color = "var(--error-neon)"; }

        const msgEl = document.getElementById('res-message');
        msgEl.textContent = msg;
        msgEl.style.color = color;
        document.getElementById('res-percentage').style.color = color;
    }
};

document.addEventListener('DOMContentLoaded', () => {
    dashboardController.render();
});
</script>
</body>
</html>